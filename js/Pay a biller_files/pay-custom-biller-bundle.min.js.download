!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){"use strict";var t={};t.fileapi=void 0!==e("<input type='file'/>").get(0).files,t.formdata=void 0!==window.FormData;var a=!!e.fn.prop;function r(t){var a=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(a))}function o(t){var a=t.target,r=e(a);if(!r.is("[type=submit],[type=image]")){var o=r.closest("[type=submit]");if(0===o.length)return;a=o[0]}var n=this;if(n.clk=a,"image"==a.type)if(void 0!==t.offsetX)n.clk_x=t.offsetX,n.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var i=r.offset();n.clk_x=t.pageX-i.left,n.clk_y=t.pageY-i.top}else n.clk_x=t.pageX-a.offsetLeft,n.clk_y=t.pageY-a.offsetTop;setTimeout(function(){n.clk=n.clk_x=n.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}e.fn.attr2=function(){if(!a)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(r){if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var o,i,s,l=this;"function"==typeof r?r={success:r}:void 0===r&&(r={}),o=r.type||this.attr2("method"),(s=(s="string"==typeof(i=r.url||this.attr2("action"))?e.trim(i):"")||window.location.href||"")&&(s=(s.match(/^([^#]+)/)||[])[1]),r=e.extend(!0,{url:s,success:e.ajaxSettings.success,type:o||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},r);var d={};if(this.trigger("form-pre-serialize",[this,r,d]),d.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(r.beforeSerialize&&!1===r.beforeSerialize(this,r))return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var c=r.traditional;void 0===c&&(c=e.ajaxSettings.traditional);var m,u=[],p=this.formToArray(r.semantic,u);if(r.data&&(r.extraData=r.data,m=e.param(r.data,c)),r.beforeSubmit&&!1===r.beforeSubmit(p,this,r))return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[p,this,r,d]),d.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=e.param(p,c);m&&(v=v?v+"&"+m:m),"GET"==r.type.toUpperCase()?(r.url+=(r.url.indexOf("?")>=0?"&":"?")+v,r.data=null):r.data=v;var y=[];if(r.resetForm&&y.push(function(){l.resetForm()}),r.clearForm&&y.push(function(){l.clearForm(r.includeHidden)}),!r.dataType&&r.target){var h=r.success||function(){};y.push(function(t){var a=r.replaceTarget?"replaceWith":"html";e(r.target)[a](t).each(h,arguments)})}else r.success&&y.push(r.success);if(r.success=function(e,t,a){for(var o=r.context||this,n=0,i=y.length;n<i;n++)y[n].apply(o,[e,t,a||l,l])},r.error){var f=r.error;r.error=function(e,t,a){var o=r.context||this;f.apply(o,[e,t,a,l])}}if(r.complete){var C=r.complete;r.complete=function(e,t){var a=r.context||this;C.apply(a,[e,t,l])}}var g=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}).length>0,$="multipart/form-data",E=l.attr("enctype")==$||l.attr("encoding")==$,D=t.fileapi&&t.formdata;n("fileAPI :"+D);var b,S=(g||E)&&!D;!1!==r.iframe&&(r.iframe||S)?r.closeKeepAlive?e.get(r.closeKeepAlive,function(){b=U(p)}):b=U(p):b=(g||E)&&D?function(t){for(var a=new FormData,n=0;n<t.length;n++)a.append(t[n].name,t[n].value);if(r.extraData){var i=function(t){var a,o,n=e.param(t,r.traditional).split("&"),i=n.length,s=[];for(a=0;a<i;a++)n[a]=n[a].replace(/\+/g," "),o=n[a].split("="),s.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return s}(r.extraData);for(n=0;n<i.length;n++)i[n]&&a.append(i[n][0],i[n][1])}r.data=null;var s=e.extend(!0,{},e.ajaxSettings,r,{contentType:!1,processData:!1,cache:!1,type:o||"POST"});r.uploadProgress&&(s.xhr=function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(e){var t=0,a=e.loaded||e.position,o=e.total;e.lengthComputable&&(t=Math.ceil(a/o*100)),r.uploadProgress(e,a,o,t)},!1),t});s.data=null;var l=s.beforeSend;return s.beforeSend=function(e,t){r.formData?t.data=r.formData:t.data=a,l&&l.call(this,e,t)},e.ajax(s)}(p):e.ajax(r),l.removeData("jqxhr").data("jqxhr",b);for(var I=0;I<u.length;I++)u[I]=null;return this.trigger("form-submit-notify",[this,r]),this;function U(t){var i,s,d,c,m,p,v,y,h,f,C,g,$=l[0],E=e.Deferred();if(E.abort=function(e){y.abort(e)},t)for(s=0;s<u.length;s++)i=e(u[s]),a?i.prop("disabled",!1):i.removeAttr("disabled");if((d=e.extend(!0,{},e.ajaxSettings,r)).context=d.context||d,m="jqFormIO"+(new Date).getTime(),d.iframeTarget?(f=(p=e(d.iframeTarget)).attr2("name"))?m=f:p.attr2("name",m):(p=e('<iframe name="'+m+'" src="'+d.iframeSrc+'" />')).css({position:"absolute",top:"-1000px",left:"-1000px"}),v=p[0],y={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var a="timeout"===t?"timeout":"aborted";n("aborting upload... "+a),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(e){}p.attr("src",d.iframeSrc),y.error=a,d.error&&d.error.call(d.context,y,a,t),c&&e.event.trigger("ajaxError",[y,d,a]),d.complete&&d.complete.call(d.context,y,a)}},(c=d.global)&&0==e.active++&&e.event.trigger("ajaxStart"),c&&e.event.trigger("ajaxSend",[y,d]),d.beforeSend&&!1===d.beforeSend.call(d.context,y,d))return d.global&&e.active--,E.reject(),E;if(y.aborted)return E.reject(),E;(h=$.clk)&&(f=h.name)&&!h.disabled&&(d.extraData=d.extraData||{},d.extraData[f]=h.value,"image"==h.type&&(d.extraData[f+".x"]=$.clk_x,d.extraData[f+".y"]=$.clk_y));var D=1,b=2;function S(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){n("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(a){n("cannot get iframe.contentDocument: "+a),t=e.document}return t}var I=e("meta[name=csrf-token]").attr("content"),U=e("meta[name=csrf-param]").attr("content");function T(){var t=l.attr2("target"),a=l.attr2("action"),r=l.attr("enctype")||l.attr("encoding")||"multipart/form-data";$.setAttribute("target",m),o&&!/post/i.test(o)||$.setAttribute("method","POST"),a!=d.url&&$.setAttribute("action",d.url),d.skipEncodingOverride||o&&!/post/i.test(o)||l.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),d.timeout&&(g=setTimeout(function(){C=!0,N(D)},d.timeout));var i=[];try{if(d.extraData)for(var s in d.extraData)d.extraData.hasOwnProperty(s)&&(e.isPlainObject(d.extraData[s])&&d.extraData[s].hasOwnProperty("name")&&d.extraData[s].hasOwnProperty("value")?i.push(e('<input type="hidden" name="'+d.extraData[s].name+'">').val(d.extraData[s].value).appendTo($)[0]):i.push(e('<input type="hidden" name="'+s+'">').val(d.extraData[s]).appendTo($)[0]));d.iframeTarget||p.appendTo("body"),v.attachEvent?v.attachEvent("onload",N):v.addEventListener("load",N,!1),setTimeout(function e(){try{var t=S(v).readyState;n("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(e){n("Server abort: ",e," (",e.name,")"),N(b),g&&clearTimeout(g),g=void 0}},15);try{$.submit()}catch(e){document.createElement("form").submit.apply($)}}finally{$.setAttribute("action",a),$.setAttribute("enctype",r),t?$.setAttribute("target",t):l.removeAttr("target"),e(i).remove()}}U&&I&&(d.extraData=d.extraData||{},d.extraData[U]=I),d.forceSync?T():setTimeout(T,10);var P,F,w,O=50;function N(t){if(!y.aborted&&!w){if((F=S(v))||(n("cannot access response document"),t=b),t===D&&y)return y.abort("timeout"),void E.reject(y,"timeout");if(t==b&&y)return y.abort("server abort"),void E.reject(y,"error","server abort");if(F&&F.location.href!=d.iframeSrc||C){v.detachEvent?v.detachEvent("onload",N):v.removeEventListener("load",N,!1);var a,r="success";try{if(C)throw"timeout";var o="xml"==d.dataType||F.XMLDocument||e.isXMLDoc(F);if(n("isXml="+o),!o&&window.opera&&(null===F.body||!F.body.innerHTML)&&--O)return n("requeing onLoad callback, DOM not available"),void setTimeout(N,250);var i=F.body?F.body:F.documentElement;y.responseText=i?i.innerHTML:null,y.responseXML=F.XMLDocument?F.XMLDocument:F,o&&(d.dataType="xml"),y.getResponseHeader=function(e){return{"content-type":d.dataType}[e.toLowerCase()]},i&&(y.status=Number(i.getAttribute("status"))||y.status,y.statusText=i.getAttribute("statusText")||y.statusText);var s=(d.dataType||"").toLowerCase(),l=/(json|script|text)/.test(s);if(l||d.textarea){var m=F.getElementsByTagName("textarea")[0];if(m)y.responseText=m.value,y.status=Number(m.getAttribute("status"))||y.status,y.statusText=m.getAttribute("statusText")||y.statusText;else if(l){var u=F.getElementsByTagName("pre")[0],h=F.getElementsByTagName("body")[0];u?y.responseText=u.textContent?u.textContent:u.innerText:h&&(y.responseText=h.textContent?h.textContent:h.innerText)}}else"xml"==s&&!y.responseXML&&y.responseText&&(y.responseXML=x(y.responseText));try{P=k(y,s,d)}catch(e){r="parsererror",y.error=a=e||r}}catch(e){n("error caught: ",e),r="error",y.error=a=e||r}y.aborted&&(n("upload aborted"),r=null),y.status&&(r=y.status>=200&&y.status<300||304===y.status?"success":"error"),"success"===r?(d.success&&d.success.call(d.context,P,"success",y),E.resolve(y.responseText,"success",y),c&&e.event.trigger("ajaxSuccess",[y,d])):r&&(void 0===a&&(a=y.statusText),d.error&&d.error.call(d.context,y,r,a),E.reject(y,"error",a),c&&e.event.trigger("ajaxError",[y,d,a])),c&&e.event.trigger("ajaxComplete",[y,d]),c&&!--e.active&&e.event.trigger("ajaxStop"),d.complete&&d.complete.call(d.context,y,r),w=!0,d.timeout&&clearTimeout(g),setTimeout(function(){d.iframeTarget?p.attr("src",d.iframeSrc):p.remove(),y.responseXML=null},100)}}}var x=e.parseXML||function(e,t){return window.ActiveXObject?((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},A=e.parseJSON||function(e){return window.eval("("+e+")")},k=function(t,a,r){var o=t.getResponseHeader("content-type")||"",n="xml"===a||!a&&o.indexOf("xml")>=0,i=n?t.responseXML:t.responseText;return n&&"parsererror"===i.documentElement.nodeName&&e.error&&e.error("parsererror"),r&&r.dataFilter&&(i=r.dataFilter(i,a)),"string"==typeof i&&("json"===a||!a&&o.indexOf("json")>=0?i=A(i):("script"===a||!a&&o.indexOf("javascript")>=0)&&e.globalEval(i)),i};return E}},e.fn.ajaxForm=function(t){if((t=t||{}).delegation=t.delegation&&e.isFunction(e.fn.on),!t.delegation&&0===this.length){var a={s:this.selector,c:this.context};return!e.isReady&&a.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(a.s,a.c).ajaxForm(t)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return t.delegation?(e(document).off("submit.form-plugin",this.selector,r).off("click.form-plugin",this.selector,o).on("submit.form-plugin",this.selector,t,r).on("click.form-plugin",this.selector,t,o),this):this.ajaxFormUnbind().bind("submit.form-plugin",t,r).bind("click.form-plugin",t,o)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(a,r){var o=[];if(0===this.length)return o;var n,i,s,l,d,c,m,u,p=this[0],v=this.attr("id"),y=a?p.getElementsByTagName("*"):p.elements;if(y&&!/MSIE [678]/.test(navigator.userAgent)&&(y=e(y).get()),v&&(n=e(':input[form="'+v+'"]').get()).length&&(y=(y||[]).concat(n)),!y||!y.length)return o;for(i=0,m=y.length;i<m;i++)if((l=(c=y[i]).name)&&!c.disabled)if(a&&p.clk&&"image"==c.type)p.clk==c&&(o.push({name:l,value:e(c).val(),type:c.type}),o.push({name:l+".x",value:p.clk_x},{name:l+".y",value:p.clk_y}));else if((d=e.fieldValue(c,!0))&&d.constructor==Array)for(r&&r.push(c),s=0,u=d.length;s<u;s++)o.push({name:l,value:d[s]});else if(t.fileapi&&"file"==c.type){r&&r.push(c);var h=c.files;if(h.length)for(s=0;s<h.length;s++)o.push({name:l,value:h[s],type:c.type});else o.push({name:l,value:"",type:c.type})}else null!==d&&void 0!==d&&(r&&r.push(c),o.push({name:l,value:d,type:c.type,required:c.required}));if(!a&&p.clk){var f=e(p.clk),C=f[0];(l=C.name)&&!C.disabled&&"image"==C.type&&(o.push({name:l,value:f.val()}),o.push({name:l+".x",value:p.clk_x},{name:l+".y",value:p.clk_y}))}return o},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var a=[];return this.each(function(){var r=this.name;if(r){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var n=0,i=o.length;n<i;n++)a.push({name:r,value:o[n]});else null!==o&&void 0!==o&&a.push({name:this.name,value:o})}}),e.param(a)},e.fn.fieldValue=function(t){for(var a=[],r=0,o=this.length;r<o;r++){var n=this[r],i=e.fieldValue(n,t);null===i||void 0===i||i.constructor==Array&&!i.length||(i.constructor==Array?e.merge(a,i):a.push(i))}return a},e.fieldValue=function(t,a){var r=t.name,o=t.type,n=t.tagName.toLowerCase();if(void 0===a&&(a=!0),a&&(!r||t.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!t.checked||("submit"==o||"image"==o)&&t.form&&t.form.clk!=t||"select"==n&&-1==t.selectedIndex))return null;if("select"==n){var i=t.selectedIndex;if(i<0)return null;for(var s=[],l=t.options,d="select-one"==o,c=d?i+1:l.length,m=d?i:0;m<c;m++){var u=l[m];if(u.selected){var p=u.value;if(p||(p=u.attributes&&u.attributes.value&&!u.attributes.value.specified?u.text:u.value),d)return p;s.push(p)}}return s}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var a=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,o=this.tagName.toLowerCase();a.test(r)||"textarea"==o?this.value="":"checkbox"==r||"radio"==r?this.checked=!1:"select"==o?this.selectedIndex=-1:"file"==r?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(r)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var a=this.type;if("checkbox"==a||"radio"==a)this.checked=t;else if("option"==this.tagName.toLowerCase()){var r=e(this).parent("select");t&&r[0]&&"select-one"==r[0].type&&r.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1});var servicesCtrl={settings:{banklovUrl:"banklovall.json",ibanklov:"ibanklov.json"},init:function(e){this.settings=$.extend(servicesCtrl.settings,e);var t=this.settings,a=store.get("apiVersion");t.apiVersion!=a&&(store.forEach(function(e){"_SPECS_PAYMENT_"==e.substring(0,15)&&store.remove(e)}),store.set("apiVersion",t.apiVersion))},getDataFromEndPoint:function(e,t){var a=servicesCtrl.getLocalData(t);if(remitaUiCtrl.showLoading(),servicesCtrl.isNull(a)){var r=this.settings;$.ajax({url:r.apiURL+e,dataType:"text",async:!1,success:function(e){var a=servicesCtrl.remitaDecodeJson(e);a&&a.responseData&&a.responseData.length>0&&servicesCtrl.setLocalData(t,a)},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}})}},getDataEndForCustomField:function(e,t){this.settings;return $.ajax({url:e,dataType:"text"}).then(function(e){var t=servicesCtrl.remitaDecodeJson(e);if("00"==t.responseCode){var a=$.Deferred();return a.resolve(t.responseData),a.promise()}remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])})},getDataEndPointData:function(e,t){var a=this.settings,r=servicesCtrl.getLocalData(t);if(servicesCtrl.isNull(r))return $.ajax({url:a.apiURL+e,dataType:"text"}).then(function(e){var a=servicesCtrl.remitaDecodeJson(e);if("00"==a.responseCode)return a&&a.responseData&&a.responseData.length>0&&servicesCtrl.setLocalData(t,a),a;remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])});var o=$.Deferred();return o.resolve(servicesCtrl.getLocalData(t)),o.promise()},isNull:function(e){var t=!0;try{e.responseCode,t=!1}catch(e){}return t},remitaEncode:function(e){return $.base64.encode(e)},remitaDecode:function(e){var t=e;if(t)return e.responseText&&(t=e.responseText),t=$.base64.decode(t),JSON.parse(t)},remitaDecodeJson:function(e){var t=e;if(t)return e.responseText&&(t=e.responseText),t=$.base64.decode(t),JSON.parse(t)},setLocalData:function(e,t){var a=servicesCtrl.remitaEncode(JSON.stringify(t));return store.set("_SPECS_PAYMENT_"+e,a)},getLocalData:function(e){var t=store.get("_SPECS_PAYMENT_"+e);if(t){var a=$.base64.decode(t);if(a)return JSON.parse(a)}},generatePaymentRRR:function(e,t){var a=servicesCtrl.remitaEncode(JSON.stringify(t));return $.ajax({url:e,type:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},dataType:"text",data:a})},logPayment:function(e){return $.ajax({url:"/remita/onepage/cloud/send/api/posttasksvc/profile/paymentlog.json",type:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},dataType:"text",data:servicesCtrl.remitaEncode(JSON.stringify(e))})},removeLocalData:function(e){return store.remove(e)},storeDataFromEndPoint:function(e,t){servicesCtrl.setLocalData(e,t)}};$(function(){servicesCtrl.init(pageSettings)});var Forms=Forms||{};Forms.postRedirect=function(e){var t=(e=e||{}).url,a=(e.method,e.params||{});e.headers;document.getElementById("ifrdiv").innerHTML='<iframe id="remita_ifrm_payment" style="width:100% !important; min-height: 450px !important;"></iframe>';$("#remita_ifrm_payment");var r=document.getElementById("remita_ifrm_payment");(r=r.contentWindow||r.contentDocument.document||r.contentDocument).document.open();var o=" ";o+="<form id='remita_ifrm_form_payment' action='"+t+"' method='post'>",o+="<input type='hidden' name='payload' value='"+a.payload+"'>",o+="<input type='hidden' name='paymentDetails' value='"+a.paymentDetails+"'>",o+="</form>",r.document.write(o),r.document.getElementById("remita_ifrm_form_payment").submit(),$("#processingInvoice").addClass("hidden")};var remitaUiCtrl={settings:{ibanklov:"ibanklov.json",cardPattern:"0000 0000 0000 0000",deferredUserData:$.Deferred(),allowEmail:null},init:function(e){this.settings=$.extend(remitaUiCtrl.settings,e);var t=this.settings;$(document).on("click","#show-details",function(){"hide"==$("#show-details .fa").data("on")?($(".payment-details").addClass("hidden"),$("#show-details").html('<i class="fa fa-arrow-down" aria-hidden="true" data-on="show"></i>'+MESSAGE_BUNDLE["core.show.details"])):($(".payment-details").removeClass("hidden"),$("#show-details").html('<i class="fa fa-arrow-up" aria-hidden="true" data-on="hide"></i>'+MESSAGE_BUNDLE["core.hide.details"]))}),$(document).on("click","#copy-invoice-link-btn",function(e){var t=$(e.currentTarget),a=t.data("invoice-url");t.tooltip("show"),setTimeout(()=>t.tooltip("hide"),1e3),remitaUiCtrl.copyToClipboard(a)}),$(document).on("click",".service-type-card",function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),a=t.data("service-type-id");remitaUiCtrl.settings.nameOfServiceElement.val(a),remitaUiCtrl.settings.nameOfServiceElement.trigger("change"),$(e.currentTarget).hasClass("active")||($(".service-type-card").removeClass("active"),t.addClass("active"))}),$("#getTemp").click(function(){$("#getTempForm").submit()}),$(document).on("click","#bankBranches",function(){$("#bankBranchModal").on("shown.bs.modal",function(e){$.ajax({type:"get",url:t.contextPath+"/rrr/bankinfo/index.reg",success:function(e){$("#openBankBranches").html(e)}})}),$("#bankBranchModal").modal({backdrop:"static",keyboard:!0})}),$(document).on("change","#fundingSource",function(e){switch($(e.currentTarget).val()){case"ACCOUNT":$("#mfbDiv").removeClass("hidden"),$("#showHowDoYouWantToPayDirectDebitCustomFields").addClass("hidden");break;case"CARD":$("#mfbDiv").addClass("hidden"),$("#showHowDoYouWantToPayDirectDebitCustomFields").removeClass("hidden"),$("#showHowDoYouWantToPayDirectDebitCustomFields").html(remitaUiCtrl.buildCardPaymentFormFields("","",t));break;default:$("#mfbDiv").addClass("hidden"),$("#showHowDoYouWantToPayDirectDebitCustomFields").addClass("hidden")}}),$(window).on("load",function(){var e=$("#itemTotal").val(),t=$("#nameOfServiceOrPurpose").val();$("#paymentDetails").trigger("reset"),$("#mainForm").trigger("reset"),$("#mainForm").trigger("reset"),e&&$("#itemTotal").val(e),t&&$("#nameOfServiceOrPurpose").val(t)}),$(document).on("click","#viewPfaCode",function(){$("#pfaModal").on("shown.bs.modal",function(e){$.ajax({type:"get",url:t.contextPath+"/rrr/corpinfo/pfa-codes.json",success:function(e){remitaUiCtrl.buildPfaCodeList(e)}})}),$("#pfaModal").modal({backdrop:"static",keyboard:!0})}),remitaUiCtrl.getCurrencyLov(t),$(document).on("change blur","input.dataloadrule,select.dataloadrule",function(e){var a=e.currentTarget.value,r=e.currentTarget.id,o=t.nameOfServiceElement.val();e.currentTarget.placeholder;""!=a&&remitaUiCtrl.validateDataLoadRule(o,a,r)}),$(document).on("blur",".validateUrl",function(e){var t=e.currentTarget.value,a=e.currentTarget.id,r=$("#nameOfServiceOrPurpose").val(),o=e.currentTarget.placeholder;if(remitaUiCtrl.validateUrl(r,t,a))remitaUiCtrl.hideFormErrors();else{var n=o+" value  is invalid";remitaUiCtrl.showFormErrors(n)}}),$(document).on("change","#recurringPaymentType",function(e){var t=$("#recurringPaymentType").val();"DD"==t?($("#checkIfDirectDebt").text("MAXIMUM DEBIT AMOUNT PER TRANSACTION"),$("#standingOrder_os").addClass("hidden"),$("#directDebt_dd").removeClass("hidden"),$("#everyStandinOrderDiv").addClass("hidden"),$("#maxUpload").removeClass("hidden")):"SO"==t&&($("#checkIfDirectDebt").text("AMOUNT TO PAY"),$("#standingOrder_os").removeClass("hidden"),$("#directDebt_dd").addClass("hidden"),$("#everyStandinOrderDiv").removeClass("hidden"),$("#maxUpload").addClass("hidden"))}),$(document).on("click","#reciptOrInvoice",function(){var e=remitaUiCtrl.getUserDataFromSession()[0];"PY"===e.paymentType&&"APPROVED"===e.status?window.location.href=t.receiptUrl+"/send/api/print/billsvc/biller/"+remitaUiCtrl.getUserDataFromSession()[0].rrrNumber+"/printrecieptRequest.pdf":window.location.href=t.contextPath+"/rrr/"+e.id+"/1/viewFileDetails.pdf"})},relocateInvoice:function(e){$("#main-content-invoice").html(e),$("#main-content").hide(),$("#main-content-invoice").show(),$("#modal-su").modal("hide"),$(this).scrollTop(0)},getCurrentDate:function(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,r=e.getFullYear();return t<10&&(t="0"+t),a<10&&(a="0"+a),e=a+"/"+t+"/"+r},checkNullValue:function(e){if("null"===e)return" "},validateEmailAddress:function(e){var t=$("#"+e);return!(""==t.val()||!/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/gim.test(t.val()))},buildPfaCodeList:function(e){var t="";t+='<table class="table table-condensed sp-items-table">',t+="<thead>",t+="<tr>",t+="<th>PFA</th>",t+="<th>PFA CODE</th>",t+="</tr>",t+="</thead>",t+="<tbody>",$.each(e,function(e,a){t+="<tr>",t+="<td>"+a.NAME+"</td>",t+="<td>"+a.ID+"</td>",t+="</tr>"}),t+="</tbody>",t+="</table>",$("#openPfaCodes").html(t)},validatePhoneNumber:function(elementID){var customSetting=this.settings,telInput=$("#"+elementID),errorMsg=$("#error-msg"),validMsg=$("#valid-msg");telInput.intlTelInput({initialCountry:"auto",geoIpLookup:function(e){$.get("https://ipinfo.io",function(){},"jsonp").always(function(t){var a=t&&t.country?t.country:"";e(a)})},utilsScript:customSetting.utilScriptPath,autoHideDialCode:!0,nationalMode:!1,preferredCountries:eval("['"+MESSAGE_BUNDLE["core.currency.shortcode"]+"', 'us', 'gb' ]"),defaultCountry:MESSAGE_BUNDLE["core.currency.shortcode"]});var reset=function(){telInput.removeClass("form-error"),errorMsg.addClass("hide"),validMsg.addClass("hide")};telInput.blur(function(){if($.trim(telInput.val()))return telInput.intlTelInput("isValidNumber")?(validMsg.removeClass("hide"),!0):(errorMsg.removeClass("hide"),!1)}),telInput.on("keyup change",reset)},formatItemTotalAmount:function(e){var t=e,a=t.itemTotal.val();t.itemTotal.val(remitaUiCtrl.formatCurrency(a))},loadCurrencySign:function(e){var t=e;t.serviceTypeId=t.selectCurrency.val(),t.setCurrencySign.html(t.selectCurrency.val())},getCurrencySymbol:function(e,t){t.setCurrencySign.html(e)},getCaptchaImage:function(e,t,a,r){var o=this.settings;$.ajax({url:o.captPath+"captcha/challenge.json",dataType:"JSON",type:"GET",success:function(o){remitaUiCtrl.hideFormErrors();var n=o,i={crid:n._crid};return"PayOnce"==e?sessionStorage.setItem("cridValuePayOnce",JSON.stringify(i)):sessionStorage.setItem("cridValue",JSON.stringify(i)),$("#"+t).prop("src","data:image/png;base64,"+n.image),$("#"+a).val(" "),$("#"+r).html(" "),!0},error:function(e){return remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]),!1}})},checkCaptchaAnswer:function(e,t){var a;return $.ajax({url:this.settings.captPath+"captcha/challenge.json?answer="+e+"&_crid="+t,dataType:"JSON",type:"POST",success:function(e){a=!!e.status},error:function(e){a=!1}}),a},loadCusBiller:function(e,t){t.billerName.removeClass("hidden"),t.billerName.html('<h3  style="margin-bottom: 0px !important; padding-top: 10px !important;">'+e+"</h3>"),$("#whoDoYouWantToPay").prop("disabled","disabled"),$("#whoDoYouWantToPay").prop("placeholder",e),$("#hideWhoDoYouWantToPay").hide()},getSpecificBillerName:function(e,t){remitaUiCtrl.getBillerEmailRequirementById(e);var a=servicesCtrl.getLocalData(e+"name");a?($("#pageTitle2").html(a.name),remitaUiCtrl.loadCusBiller(a.name,t)):$.ajax({url:this.settings.apiURL+e+"/billerName.json",dataType:"text",type:"GET",success:function(a){var r=servicesCtrl.remitaDecode(a);remitaUiCtrl.loadCusBiller(r.name,t),servicesCtrl.setLocalData(e+"name",r),$("#pageTitle2").html(r.name)},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}})},checkForEmptyInput:function(){var e=!1;return $(":input").each(function(t,a){$(a).is(":visible")&&$(a).is("[required]")&&($(a).val()&&"string"==typeof $(a).val()&&""==$(a).val().trim()?(e=!0,remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.complete.mandtory.field"]),$(a).addClass("form-error")):$(a).removeClass("form-error"))}),e},checkCaptchaAnswerOnBlur:function(e,t,a){var r=a;remitaUiCtrl.checkCaptchaAnswer(e,t)?(r.captchaError.html(" "),r.submitButton.addClass("green effect fill-horizontal"),r.submitButton.removeAttr("disabled")):remitaUiCtrl.captchaErrorMsg(r)},initTooltips:function(){$('[data-toggle="tooltip"]').tooltip({trigger:"click"})},copyToClipboard:function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},setInvoiceUrl:function(e){$("#copy-invoice-link-btn").data("invoice-url",e)},captchaErrorMsg:function(e){var t=e;t.captchaError.removeClass("hidden"),t.captchaError.html('<i class="fa fa-exclamation-triangle" style="color: #ff0000 !important;" aria-hidden="true"></i>'+MESSAGE_BUNDLE["core.captcha.do.not.match"]+"</span>"),t.captchaError.attr("required","required")},resetForms:function(e){var t=e;t.output.text(" "),t.serviceChargeSpan.text(" "),t.totalAmountToBePaySpan.text(" "),t.showServiceCharge.text(""),t.showServiceCharge.addClass("hidden"),t.billerName.addClass("hidden"),t.billerLogo.addClass("hidden"),t.mainForm.trigger("reset"),t.CustomForm.rebuild,t.CustomForm.trigger("reset"),t.paymentDetails.trigger("reset"),remitaUiCtrl.hideFormErrors(),remitaUiCtrl.resetItemAmountInputValues(t),$("#processingInvoice").addClass("hidden")},removeCaptchaInputSpace:function(e){return e.split(" ").join("")},formatMoneyInput:function(e){var t=e.value;t=t.replace(/,/g,""),e.value=numeral(t).format("0,0.00")},formatCurrency:function(e){return numeral(e).format("0,0.00")},getCurrencyLov:function(e){var t=e;$(function(){var e=servicesCtrl.getLocalData("currency");e?$.each(e.responseData,function(e,t){if(t.code==MESSAGE_BUNDLE["core.currency.code"])var a="selected";$(".set_currency").append('<option data-code="'+t.code+'" data-curName="'+t.name+'" data-koboName="'+t.koboName+'" value="'+t.symbol+'" '+a+">"+t.code+" - "+t.shortName+"</option>")}):$.ajax({url:t.apiURL+"currencylov.json",dataType:"text",type:"GET",success:function(e){remitaUiCtrl.hideFormErrors();var t=servicesCtrl.remitaDecode(e);"00"==t.responseCode?(servicesCtrl.setLocalData("currency",t),$.each(t.responseData,function(e,t){if(t.code==MESSAGE_BUNDLE["core.currency.code"])var a="selected";$(".set_currency").append('<option data-code="'+t.code+'" data-curName="'+t.name+'" data-koboName="'+t.koboName+'" value="'+t.symbol+'" '+a+">"+t.code+" - "+t.shortName+"</option>")})):remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}})})},loadFnFBankLovToGetServiceCharge:function(e,t){var a=t,r=servicesCtrl.getLocalData("banklov");$(e).easyAutocomplete({data:r,listLocation:"responseData",getValue:function(e){return e.NAME},list:{maxNumberOfElements:30,match:{enabled:!0},onChooseEvent:function(){$(e).attr("data-mfbCode",$(e).getSelectedItemData().ID),$(e).attr("data-auto-key",$(e).getSelectedItemData().ID);var t=$("#itemTotalStandinOrder").val(),r=$("#payersEmailStandinOrder").val(),o=$("#selectCurrencyStandinOrder").find(":selected").data("code"),n=$(e).getSelectedItemData().ID,i=a.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(i,t,o,"Instant","Instant","",n,r,a)},onShowListEvent:function(){$(e).removeClass("ui-autocomplete-loading")},onLoadEvent:function(){$(e).addClass("ui-autocomplete-loading")}}})},loadOtpBankForMandate:function(e,t){var a=t,r=servicesCtrl.getLocalData("otpBankLov"),o=r;r&&r.responseData&&(o.responseData=r.responseData.filter(function(e,t){return e&&e.name})),$(e).easyAutocomplete({data:o,listLocation:"responseData",getValue:function(e){return e&&e.name?e.name:MESSAGE_BUNDLE.getKey("core.not.available")},list:{maxNumberOfElements:30,match:{enabled:!0},onChooseEvent:function(){$(e).attr("data-otpenabled",$(e).getSelectedItemData().enabled),$(e).attr("data-regauthtype",$(e).getSelectedItemData().regAuthType),$(e).attr("data-mfbCode",$(e).getSelectedItemData().bankId),$(e).attr("data-auto-key",$(e).getSelectedItemData().bankId);var t=$("#itemTotalStandinOrder").val(),r=$("#payersEmailStandinOrder").val(),o=$("#selectCurrencyStandinOrder").find(":selected").data("code"),n=$(e).getSelectedItemData().bankId,i=a.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(i,t,o,"Instant","Instant","",n,r,a)},onShowListEvent:function(){$(e).removeClass("ui-autocomplete-loading")},onLoadEvent:function(){$(e).addClass("ui-autocomplete-loading")}}})},loadFnFBankLov:function(e){var t=servicesCtrl.getLocalData("banklov");$(e).easyAutocomplete({data:t,listLocation:"responseData",getValue:function(e){return e.NAME},list:{maxNumberOfElements:30,match:{enabled:!0},onChooseEvent:function(){$(e).attr("data-mfbCode",$(e).getSelectedItemData().ID),$(e).attr("data-auto-key",$(e).getSelectedItemData().ID)},onShowListEvent:function(){$(e).removeClass("ui-autocomplete-loading")},onLoadEvent:function(){$(e).addClass("ui-autocomplete-loading")}}})},checkForExpireCardDate:function(e){var t=new Date,a=t.getMonth()+1;a<9&&(a="0"+a);var r=t.getFullYear(),o=$("#"+e).val().split("/"),n=parseInt(r.toString().substr(2,4)),i=parseInt(o[1]),s=parseInt(o[0]),l=!1;return i>n?s>12&&(l=!0):i==n?s<a&&(l=!0):l=!0,l||$("#"+e).removeClass("form-error"),l},getCardLovEInvoice:function(e){var t=e;$(function(){var e=servicesCtrl.getLocalData("cardloveinvoice"),a=servicesCtrl.getLocalData("mandateCardloveinvoice");e&&a?(t.howDoYouWantToPay.append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(e.responseData,function(e,a){t.howDoYouWantToPay.append('<option value="'+a.type+'"data-cancapture="'+a.canCapture+'">'+a.name+"</option>")}),$("#fundingSource").append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(a,function(e,t){$("#fundingSource").append('<option value="'+t.type+'"data-cancapture="'+t.canCapture+'">'+t.name+"</option>")})):($.ajax({url:t.apiURL+"cardonlylov.json",dataType:"text",success:function(e){var a=servicesCtrl.remitaDecode(e);"00"==a.responseCode?(servicesCtrl.setLocalData("cardloveinvoice",a),t.howDoYouWantToPay.append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(a.responseData,function(e,a){t.howDoYouWantToPay.append('<option value="'+a.type+'"data-cancapture="'+a.canCapture+'">'+a.name+"</option>")})):remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}}),$.ajax({url:t.apiURL+"mandate/cardonlylov.json",dataType:"text",success:function(e){var t=servicesCtrl.remitaDecode(e);"00"==t.responseCode?(servicesCtrl.setLocalData("mandateCardloveinvoice",t),$("#fundingSource").append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(t.responseData,function(e,t){$("#fundingSource").append('<option value="'+t.type+'"data-cancapture="'+t.canCapture+'">'+t.name+"</option>")})):remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}}))})},appendCardDate:function(e,t){t.howDoYouWantToPay.append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(e,function(e,a){1==t.isEInvoice?("BANKBRANCH"!=a.type&&t.howDoYouWantToPay.append('<option value="'+a.type+'"data-cancapture="'+a.canCapture+'">'+a.name+"</option>"),remitaUiCtrl.settings.isIntegration&&"BANKBRANCH"==a.type&&t.howDoYouWantToPay.append('<option value="'+a.type+'"data-cancapture="'+a.canCapture+'">'+a.name+"</option>")):t.howDoYouWantToPay.append('<option value="'+a.type+'"data-cancapture="'+a.canCapture+'">'+a.name+"</option>")})},getCardLov:function(e){var t=e;$(function(){var e=servicesCtrl.getLocalData("cardlov"),a=servicesCtrl.getLocalData("mandateCardloveinvoice");e&&a?(remitaUiCtrl.appendCardDate(e.responseData,t),$("#fundingSource").append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(a.responseData,function(e,t){$("#fundingSource").append('<option value="'+t.type+'"data-cancapture="'+t.canCapture+'">'+t.name+"</option>")})):($.ajax({url:t.apiURL+"send/api/billsvc/biller/web/cardlov.json",dataType:"text",success:function(e){var a=servicesCtrl.remitaDecode(e);"00"==a.responseCode?(servicesCtrl.setLocalData("cardlov",a),remitaUiCtrl.appendCardDate(a.responseData,t)):remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}}),$.ajax({url:t.apiURL+"mandate/cardonlylov.json",dataType:"text",success:function(e){var t=servicesCtrl.remitaDecode(e);"00"==t.responseCode?(servicesCtrl.setLocalData("mandateCardloveinvoice",t),$("#fundingSource").append('<option value="pleaseselect" selected>'+MESSAGE_BUNDLE["core.please.select.how.you.want.to.pay"]+"</option>"),$.each(t.responseData,function(e,t){$("#fundingSource").append('<option value="'+t.type+'"data-cancapture="'+t.canCapture+'">'+t.name+"</option>")})):remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}}))})},storeUserDataInSession:function(e){localStorage.removeItem("_SPECS_GLOBAL_sri");var t=JSON.stringify(e);localStorage.setItem("_SPECS_GLOBAL_sri",t)},getAVS:function(e,t,a){var r,o=this.settings;r={bankCode:e,accNumber:t,bvn:a};var n=servicesCtrl.remitaEncode(JSON.stringify(r));return $.ajax({url:o.apiURL+"acctlookup.json",type:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},success:function(e){return servicesCtrl.remitaDecode(e)},dataType:"text",data:n,error:function(e){return e},complete:function(){}})},getUserDataFromSession:function(){var e=localStorage.getItem("_SPECS_GLOBAL_sri");if(void 0!=e&&"undefined"!=e&&null!=e&&"null"!=e)return JSON.parse(e)},clearFormError:function(){remitaUiCtrl.hideFormErrors()},getUserData:function(){var e=$.Deferred(),t=remitaUiCtrl.settings;return remitaUiCtrl.settings.isIntegration?$.ajax({url:t.apiURL+remitaUiCtrl.settings.integrationRrr+"/billsummaryfull.json",dataType:"text",success:function(t){var a=servicesCtrl.remitaDecode(t);"00"==a.responseCode?(remitaUiCtrl.storeUserDataInSession(a.responseData),e.resolve(a.responseData)):e.reject("failed")}}):e.resolve(remitaUiCtrl.getUserDataFromSession()),e.promise()},loadSessions:function(){var e=remitaUiCtrl.settings;remitaUiCtrl.getUserData().then(function(){if(remitaUiCtrl.getUserDataFromSession()){var t=remitaUiCtrl.getUserDataFromSession()[0];$("#vatAmountTr").removeClass("hidden"),$("#chargeFeeTr").removeClass("hidden");var a=servicesCtrl.getLocalData("ib"+remitaUiCtrl.getUserDataFromSession()[0].rrrNumber);if("null"!=a&&""!=a&&"undefined"!=a&&void 0!=a?($("#printInvoiceIcon").html('<a id="reciptOrInvoice"><img src="'+e.template+'/images/print-icon-green.png" alt="print-icon"  style=" width: 20px;  cursor: pointer;"/></a>'),$("#interURL").html('<a id="redirect" class="button" href="'+a+'" style="background: #000; color: #fff;  padding: 32px 98px; font-weight: 100; letter-spacing: 3px;" target="_blank">'+MESSAGE_BUNDLE["core.proceed.to.internet.bank"]+"</a>"),$("#printInvoiceOrReciept").addClass("hidden"),$("#printInvoiceOrReciept").html(" ")):($("#printInvoiceOrReciept").removeClass("hidden"),$("#interURL").html(""),$("#printInvoiceIcon").html(" ")),$("#rrr").text(remitaUiCtrl.getUserDataFromSession()[0].rrrNumber.match(/.{1,4}/g).join("-")),$("#rrr_bank").text(remitaUiCtrl.getUserDataFromSession()[0].rrrNumber.match(/.{1,4}/g).join("-")),$("#rrr_ussd").text(remitaUiCtrl.getUserDataFromSession()[0].rrrNumber.match(/.{1,4}/g).join("-")),$("#company").text(remitaUiCtrl.getUserDataFromSession()[0].companyName),"Y"==remitaUiCtrl.getUserDataFromSession()[0].p2p?($("#address").text(""),$("#billerPhone").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryMobile),$("#billerEmail").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryEmail)):($("#address").text(remitaUiCtrl.getUserDataFromSession()[0].billerAddress),$("#billerPhone").text(remitaUiCtrl.getUserDataFromSession()[0].billerPhone),$("#billerEmail").text(remitaUiCtrl.getUserDataFromSession()[0].billerEmail),$("#billerTaxNumber").text(remitaUiCtrl.getUserDataFromSession()[0].billerTaxNumber)),$("#beneficiary").text(remitaUiCtrl.getUserDataFromSession()[0].companyName),$("#beneficiary-2").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryName),"DD"==remitaUiCtrl.getUserDataFromSession()[0].rrrType){$("#show-details-div").addClass("hidden");var r=remitaUiCtrl.getUserDataFromSession()[0].amount}else if("SO"==remitaUiCtrl.getUserDataFromSession()[0].rrrType){$("#show-details-div").addClass("hidden");r=remitaUiCtrl.getUserDataFromSession()[0].amount}else r=remitaUiCtrl.getUserDataFromSession()[0].amountDue;"PY"==remitaUiCtrl.getUserDataFromSession()[0].rrrType?("Y"==remitaUiCtrl.getUserDataFromSession()[0].showFee?$("#amount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(r-(remitaUiCtrl.getUserDataFromSession()[0].vatAmount+remitaUiCtrl.getUserDataFromSession()[0].chargeFee))):$("#amount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(r-remitaUiCtrl.getUserDataFromSession()[0].vatAmount)),$("#netAmount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(remitaUiCtrl.getUserDataFromSession()[0].netAmount))):($("#amount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(r)),"Y"==remitaUiCtrl.getUserDataFromSession()[0].showFee?$("#netAmount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(remitaUiCtrl.getUserDataFromSession()[0].amount+remitaUiCtrl.getUserDataFromSession()[0].vatAmount+remitaUiCtrl.getUserDataFromSession()[0].chargeFee)):$("#netAmount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(remitaUiCtrl.getUserDataFromSession()[0].amount+remitaUiCtrl.getUserDataFromSession()[0].vatAmount))),0==remitaUiCtrl.getUserDataFromSession()[0].vatAmount&&$("#vatAmountTr").addClass("hidden"),0==remitaUiCtrl.getUserDataFromSession()[0].chargeFee&&$("#chargeFeeTr").addClass("hidden"),$("#vatAmount").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(remitaUiCtrl.getUserDataFromSession()[0].vatAmount)),$("#chargeFee").html(remitaUiCtrl.getUserDataFromSession()[0].currency+" "+remitaUiCtrl.formatCurrency(remitaUiCtrl.getUserDataFromSession()[0].chargeFee)),$("#phoneNumber").text(remitaUiCtrl.getUserDataFromSession()[0].payerMobile),$("#email").text(remitaUiCtrl.getUserDataFromSession()[0].payerEmail),$("#payerBank").text(remitaUiCtrl.getUserDataFromSession()[0].payerBank),$("#payerAccountNumber").text(remitaUiCtrl.getUserDataFromSession()[0].payerAccountNumber),$("#beneficiaryMobile").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryMobile),"DD"==remitaUiCtrl.getUserDataFromSession()[0].rrrType?($("#netAmountTitle").html(MESSAGE_BUNDLE["maximum-debit-amount-per-transaction"]),$("#frequencyTitle").html(MESSAGE_BUNDLE["max-no-of-debits-in-a-calendar-month"]),$("#frequency").text(remitaUiCtrl.getUserDataFromSession()[0].maxUploadLimit+"Times")):($("#netAmountTitle").html(MESSAGE_BUNDLE["total-payable"]),$("#frequencyTitle").html(MESSAGE_BUNDLE.every),$("#frequency").text(remitaUiCtrl.getUserDataFromSession()[0].frequency)),$("#beneficiaryName").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryName),$("#beneficiaryEmail").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryEmail),$("#beneficiaryBank").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryBank),$("#beneficiaryAccountNumber").text(remitaUiCtrl.getUserDataFromSession()[0].beneficiaryAccountNumber),$("#descriptionOfPayment").text(remitaUiCtrl.getUserDataFromSession()[0].descriptionOfPayment),$("#payer").text(remitaUiCtrl.getUserDataFromSession()[0].payerName),$("#createdDate").html(MESSAGE_BUNDLE["core.generated.on"]+" "+remitaUiCtrl.getCurrentDate()),$("#serviceType").text(remitaUiCtrl.getUserDataFromSession()[0].descriptionOfPayment),$("#qrCode").prop("src","data:image/png;base64,"+remitaUiCtrl.getUserDataFromSession()[0].qrCode),$("#currency").text(remitaUiCtrl.getUserDataFromSession()[0].currency),$("#extraDataDiv").addClass("hidden"),"Y"==remitaUiCtrl.getUserDataFromSession()[0].p2p?($("#ivoiceInfoTitle").html(MESSAGE_BUNDLE["core.beneficiary.information"]),$("#hideBillerReqInfo4fnf").hide(),$("#hideTax4fnf").hide(),$("#beneficiary-2").hide()):($("#ivoiceInfoTitle").html(MESSAGE_BUNDLE["core.biller.information"]),$("#hideBillerReqInfo4fnf").show(),$("#hideTax4fnf").show(),$("#beneficiary-2").show());try{servicesCtrl.getLocalData("billerLogo")&&$("#billerLogo64").prop("src","data:image/png;base64,"+servicesCtrl.getLocalData("billerLogo"))}catch(n){$("#billerLogo64").prop("src",e.template+"/images/logo.png")}if(""!=remitaUiCtrl.getUserDataFromSession()[0].customFieldData){var o="";$.each(remitaUiCtrl.getUserDataFromSession()[0].customFieldData,function(e,t){o+='<tr style="border-top: #fff thin solid; border-bottom: #fff thin solid">',o+='<td class="p-10" style="width:30%"><span>'+t.DESCRIPTION+'</span></td><td class="p-10"><span>'+t.COLVAL+"</span></td>",o+="</tr>"}),$("#billerRegInfo").html(o)}if(""!=remitaUiCtrl.getUserDataFromSession()[0].extraData){$("#extraDataDiv").removeClass("hidden");var n="";$.each(remitaUiCtrl.getUserDataFromSession()[0].extraData,function(e,t){void 0!=t.value&&"undefined"!=t.value&&" "!=t.value&&(n+='<div class="invoice-font p-10 invoice-main-header" style="color: #fff !important;">'+t.label+"</div>",n+='<div style="font-size: 25px; margin: 15px 0px;">'+t.value+"</div>")}),$("#extraData").html(n)}if(remitaUiCtrl.getUserDataFromSession()[0].startDate&&($("#startDate").text(remitaUiCtrl.getUserDataFromSession()[0].startDate.replace("00:00:00","")),$("#endDate").text(remitaUiCtrl.getUserDataFromSession()[0].endDate.replace("00:00:00",""))),servicesCtrl.getLocalData("rrr"+remitaUiCtrl.getUserDataFromSession()[0].rrrNumber)){var i=servicesCtrl.getLocalData("rrr"+remitaUiCtrl.getUserDataFromSession()[0].rrrNumber),s="";if(s=null==i.responseMsg||"null"==i.responseMsg||void 0==i.responseMsg||"undefined"==i.responseMsg?MESSAGE_BUNDLE["core.invalid.payment.details"]:i.responseMsg,"00"==i.responseCode){var l="";"PY"!=remitaUiCtrl.getUserDataFromSession()[0].rrrType?($("#pageTitle").addClass("hidden"),$("#show-details-div").removeClass("hidden"),$(".payment-details").addClass("hidden"),l=MESSAGE_BUNDLE["core.mandate.activated"]):l=MESSAGE_BUNDLE["core.payment.successful"],$("#pageTitle").html(l),$("#suMsg").html('<div class="row print-bg animated zoomIn visible" style="background: #085326 !important; margin-bottom: 1rem;"><div class="col-md-12 text-center p-20 center"><span class="invoice-font" style="color:#fff !important"> <i class="fa fa-exclamation-circle" aria-hidden="true" style="padding-right: 5px; color:#fff !important"></i>'+l+" -"+s+' <i class="fa fa-exclamation-circle" aria-hidden="true" style="padding-left: 5px; color:#fff !important"></i></span></div></div>'),$("#printInvoiceOrReciept").html('<button id="reciptOrInvoice" class="button center " style="background: #006d67; color: #fff; font-size: 13px;font-weight: 100; letter-spacing: 3px;"><img src="'+e.template+'/images/print-icon.png" alt="print-icon" style="width:20px; margin-right: 5px;"/>'+MESSAGE_BUNDLE["core.print.reciept"]+"</button>"),$("#retryPayment").html(" "),$("#paymentIns").removeClass("hidden")}else $("#pageTitle").html(MESSAGE_BUNDLE["core.payment.invoice"]),$("#suMsg").html('<div class="row print-bg animated zoomIn visible" style="background: #ff0000 !important;"><div class="col-md-12 text-center p-20 center"><span class="invoice-font" style="color:#fff !important"> <i class="fa fa-exclamation-circle" aria-hidden="true" style="padding-right: 5px; color:#fff !important"></i>'+MESSAGE_BUNDLE["core.payment.failed"]+" - "+s+' <i class="fa fa-exclamation-circle" aria-hidden="true" style="padding-left: 5px; color:#fff !important"></i></span></div></div>'),$("#printInvoiceOrReciept").html('<button id="reciptOrInvoice" class="button center " style="background: #006d67; color: #fff; font-size: 13px;font-weight: 100; letter-spacing: 3px;"><img src="'+e.template+'/images/print-icon.png" alt="print-icon" style="width:20px; margin-right: 5px;"/>'+MESSAGE_BUNDLE["core.print.invoice"]+"</button>"),$("#retryPayment").html('<button class="button" id="retryPaymentButton" style="background: #000; color: #fff; font-size: 13px;font-weight: 100; letter-spacing: 3px;"><img src="'+e.template+'/images/repayment-icon.png" alt="repayment-icon" style="width:20px; margin-right: 5px;"/>'+MESSAGE_BUNDLE["core.retry.payment"]+" </button>"),$("#printInvoiceOrReciept").removeClass("center"),$("#paymentIns").addClass("hidden")}else $("#printInvoiceOrReciept").html('<button id="reciptOrInvoice" class="button center " style="background: #006d67; color: #fff; font-size: 13px;font-weight: 100; letter-spacing: 3px;"><img src="'+e.template+'/images/print-icon.png" alt="print-icon" style="width:20px; margin-right: 5px;"/>'+MESSAGE_BUNDLE["core.print.invoice"]+" </button>"),$("#paymentIns").removeClass("hidden"),$("#retryPayment").html(" ");if("CARD"===t.activationType&&($(".payment-details").find("#payerBank").closest("div").hide(),$(".payment-details").find("#payerAccountNumber").closest("div").hide(),$(".payer-bank-signature-container").hide(),$("#show-details").trigger("click")),"SO"!==t.paymentType&&"DD"!==t.paymentType||t.status.match(/ACTIVATED/i)?"CARD"!==t.activationType&&t.status.match(/ACTIVATED/i)&&$("#show-details").trigger("click"):$(".so-transaction-info").removeClass("hidden"),"PENDING"===t.status&&"PY"===t.paymentType){var d=pageSettings.invoiceBaseUrl+"/onepage/biller/"+t.rrrNumber+"/payment.spa";$("#printInvoiceOrReciept").append('<button id="copy-invoice-link-btn" type="button" data-toggle="tooltip" data-placement="top" data-original-title="Copied" class="button center " style="background: #fff;font-size: 13px;font-weight: 100;letter-spacing: 3px;"><img src="/remita/res/app-resources/template/external-onepage/images/copy_icon.svg" alt="print-icon" style="width:14px; margin-right: 5px;"> COPY INVOICE URL </button>'),remitaUiCtrl.setInvoiceUrl(d)}}})},getBillersLogoAndConvertBase64ToImage:function(e,t){var a=this.settings,r=servicesCtrl.getLocalData(e);if(r)return r.responseData[0].logo?t.billerLogo.removeClass("hidden"):t.billerLogo.addClass("hidden"),t.billerLogo.prop("src","data:image/png;base64,"+r.responseData[0].logo),servicesCtrl.setLocalData("billerLogo",r.responseData[0].logo),$("#showHR").removeClass("hidden"),!0;$.ajax({url:a.apiURL+e+"/logo.json",headers:{"Content-Type":"application/json"},type:"GET",dataType:"text",success:function(a){remitaUiCtrl.hideFormErrors();var r=servicesCtrl.remitaDecode(a);return servicesCtrl.setLocalData(e,r),r.responseData[0].logo?t.billerLogo.removeClass("hidden"):t.billerLogo.addClass("hidden"),t.billerLogo.prop("src","data:image/png;base64,"+r.responseData[0].logo),servicesCtrl.setLocalData("billerLogo",r.responseData[0].logo),$("#showHR").removeClass("hidden"),!0},error:function(e){return remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]),!1},complete:function(){}})},clearServiceChargeForm:function(){$("#totalAmoutToPay2").prop("value","0.00"),$("#serviceCharge .serviceCharge").text("0.00"),$("#totalAmoutToPay .totalAmoutToPay").text("0.00"),$("#output").text("Zero"),$("#subTotalSpan").text("0.00"),$("#serviceCharge").prop("value","0.00"),$("#totalAmoutToPay").prop("value","0.00")},resetItemAmountInputValues:function(e){e.itemTotal.val(""),e.serviceChargeSpan.text(""),e.totalAmountToBePaySpan.text(""),e.itemTotal.attr("placeholder","Amount"),e.output.text("")},getServiceTypeOnchange:function(e,t,a){var r=e;r.itemTotal.val()&&remitaUiCtrl.resetItemAmountInputValues(r),$("loadingServices").removeClass("hidden"),r.itemTotal.removeAttr("disabled"),r.itemTotal.removeAttr("readonly"),r.serviceTypeId=r.nameOfServiceOrPurpose.val();var o=r.nameOfServiceOrPurpose.find(":selected").data("url"),n=r.nameOfServiceOrPurpose.find(":selected").data("type"),i=r.nameOfServiceOrPurpose.find(":selected").data("allowintservice");return r.nameOfServiceOrPurpose.removeClass("ui-autocomplete-loading"),"Y"==r.nameOfServiceOrPurpose.find(":selected").data("uploadtype")?$("#uploadType").removeClass("hidden"):$("#uploadType").addClass("hidden"),remitaUiCtrl.validateIntegrationServiceTypes(r.nameOfServiceOrPurpose.find(":selected").text(),o,i,n),remitaUiCtrl.loadCustomBillerServiceTypeForms(r,t,a)},getServiceChargeNew:function(e,t,a,r,o,n,i,s,l){$("#itemTotal").removeClass("form-error"),$(".float-left-div").removeClass("hidden");var d=this.settings;remitaUiCtrl.loadCurrencySign(l),$("#partPayment").addClass("hidden"),""!=$("#theAmountIWantToPay").val()&&($("#partPayment").addClass("hidden"),$("#partPayment .partPayment").text(remitaUiCtrl.formatCurrency(c)));var c=parseFloat(t.replace(/,/g,""));if(t){if($("#FNF").data("fnf"))var m=d.apiURL+"p2p/fee.json";else m=d.apiURL+"fee.json";var u;u={amount:c,serviceTypeId:e,currency:a,paymentOption:r,cardPan:o,accountNumber:n,payerEmail:s,bankCode:i,channel:"REMITA_WEB"};var p=servicesCtrl.remitaEncode(JSON.stringify(u));$.ajax({url:m,type:"POST",dataType:"text",data:p,headers:{"Content-Type":"application/json; charset=utf-8"},success:function(e){var t=servicesCtrl.remitaDecode(e);if("00"==t.responseCode){remitaUiCtrl.store&&remitaUiCtrl.store.currencyCode&&remitaUiCtrl.checkForFixedCurrency(remitaUiCtrl.store,l);var a=l.selectCurrency.find(":selected").data("koboname"),r=l.selectCurrency.find(":selected").data("curname"),o=l.selectCurrency.val();if($("#hideServiceChargeDiv").removeClass("hidden"),$("#totalAmoutToPay2").prop("value",t.responseData[0].TOTALFEE),servicesCtrl.setLocalData("serviceCharges",t.responseData[0]),"Y"==t.responseData[0].APPLIEDVAT?($("#serviceVATFEE").removeClass("hidden"),$("#serviceVATFEE .serviceVATFEE").text(remitaUiCtrl.formatCurrency(t.responseData[0].VATFEE))):$("#serviceVATFEE").addClass("hidden"),$("#cvFee").addClass("hidden"),"Y"==t.responseData[0].SHOWFEE){$("#serviceCharge").removeClass("hidden");var n=t.responseData[0].PROCESSFEE,i=0;t.responseData[0].CVFEE>0&&(i=t.responseData[0].CVFEE),$("#serviceCharge .serviceCharge").text(remitaUiCtrl.formatCurrency(n+i)),specsMoneyUtil.init({currencySymbol:o,currencyName:r,currencyKoboName:a});var s=specsMoneyUtil.toWords(t.responseData[0].TOTALFEE);$("#output").text(s),$("#subTotalSpan").text(remitaUiCtrl.formatCurrency(c)),$("#serviceCharge").prop("value",t.responseData[0].PROCESSFEE),$("#totalAmoutToPay .totalAmoutToPay").text(remitaUiCtrl.formatCurrency(t.responseData[0].TOTALFEE)),$("#totalAmoutToPay").prop("value",remitaUiCtrl.formatCurrency(t.responseData[0].TOTALFEE))}else{$("#serviceCharge").addClass("hidden"),$("#serviceCharge .serviceCharge").text(),specsMoneyUtil.init({currencySymbol:o,currencyName:r,currencyKoboName:a});s=specsMoneyUtil.toWords(t.responseData[0].TOTALFEE);$("#output").text(s),$("#subTotalSpan").text(remitaUiCtrl.formatCurrency(c)),$("#serviceCharge").prop("value",""),$("#totalAmoutToPay .totalAmoutToPay").text(remitaUiCtrl.formatCurrency(t.responseData[0].TOTALFEE)),$("#totalAmoutToPay").prop("value",remitaUiCtrl.formatCurrency(t.responseData[0].TOTALFEE))}}else $("#processingInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}})}else $("#itemTotal").addClass("form-error"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.fill.the.amount.to.pay.field"])},generateReceiptWithRrr:function(e,t){var a=this.settings;$.ajax({url:a.apiURL+e+"/billsummaryfull.json",dataType:"text",success:function(e){remitaUiCtrl.hideFormErrors();var t=servicesCtrl.remitaDecode(e);"00"==t.responseCode?(t.responseData,remitaUiCtrl.storeUserDataInSession(t.responseData),"PY"!=t.responseData[0].rrrType?window.location.href=a.contextPath+"/onepage/so-invoice.spa":window.location.href=a.contextPath+"/onepage/invoice.spa"):($("#processingInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]))},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}})},handleOneServiceCardDisplay:function(e,t){remitaUiCtrl.settings.nameOfServiceElement=t.nameOfServiceOrPurpose;var a=$(".single-service-name");if(a&&a.length>0&&a.remove(),1===e.length){t.nameOfServiceOrPurpose.addClass("hidden");var r=e[0].name;t.nameOfServiceOrPurpose.val(e[0].value),t.nameOfServiceOrPurpose.trigger("change"),t.nameOfServiceOrPurpose.closest(".form-group").find("label:first-child").after('<label style="font-weight: normal;" class="single-service-name">'+r+"</label>")}else t.nameOfServiceOrPurpose.removeClass("hidden")},buildServiceCards:function(e,t){remitaUiCtrl.settings.nameOfServiceElement=t.nameOfServiceOrPurpose;var a=e.length,r="",o=t.nameOfServiceOrPurpose.closest(".form-group").find(".service-type-cards-holder .service-row");if(1===a){t.nameOfServiceOrPurpose.closest(".form-group").find("label").html(""),t.nameOfServiceOrPurpose.addClass("hidden"),e.forEach(function(e){r+='<div class="card" style="flex-grow:0!important"><div class="service-type-card"  data-service-type-id="'+e.value+'"><span class="service-type-state"></span><span>'+e.name+"</span></div></div>"}),o.html(r);var n=$(".service-type-card");n.removeClass("active"),t.isServiceType.trim()||"true"===t.isServiceType||n.trigger("click")}else if(a>1&&a<=4){var i=2===a?"flex-grow:0!important;":"flex-grow:1!important";t.nameOfServiceOrPurpose.closest(".form-group").find("label").html('Please select a Service Type<span class="red-text"> *</span>'),t.nameOfServiceOrPurpose.addClass("hidden"),e.forEach(function(e){r+='<div class="card" style="'+i+'"><div class="service-type-card" data-service-type-id="'+e.value+'"><span class="service-type-state"></span><span>'+e.name+"</span></div></div>"}),o.html(r)}else t.nameOfServiceOrPurpose.closest(".form-group").find("label").html('Name of Service/purpose<span class="red-text"> *</span>'),t.nameOfServiceOrPurpose.removeClass("hidden")},loopServiceType:function(e,t){this.settings;var a=e.filter(function(e){return"Y"!==e.acceptBuyOnCredit});$.each(a,function(e,a){t.nameOfServiceOrPurpose.append('<option data-uploadtype="'+a.uploadType+'" value="'+a.id+'" data-allowintservice="'+a.allowintservice+'" data-url="'+a.url+'" data-type="'+a.type+'">'+a.name+"</option>")}),remitaUiCtrl.handleOneServiceCardDisplay(a,t)},getBillerServicesById:function(e,t){var a=this.settings,r=servicesCtrl.getLocalData("sType"+e);remitaUiCtrl.hideFormErrors(),remitaUiCtrl.getBillerEmailRequirementById(e),r?(t.nameOfServiceOrPurpose.html(""),t.nameOfServiceOrPurpose.append('<option value="">'+MESSAGE_BUNDLE["core.please.select.service"]+"</option>"),remitaUiCtrl.loopServiceType(r.responseData,t)):$.ajax({url:a.apiURL+e+"/bills.json",dataType:"text",success:function(a){var r=servicesCtrl.remitaDecode(a);servicesCtrl.setLocalData("sType"+e,r),t.nameOfServiceOrPurpose.html(""),t.nameOfServiceOrPurpose.append('<option value="">'+MESSAGE_BUNDLE["core.please.select.service"]+" </option>"),remitaUiCtrl.loopServiceType(r.responseData,t)},error:function(){t.nameOfServiceOrPurpose.html('<option id="-1">none available</option>')},complete:function(){t.nameOfServiceOrPurpose.removeClass("ui-autocomplete-loading")}})},getBillerEmailRequirementById(e){$.ajax({url:"/remita/rrr/"+e+"/no-email-biller.json",dataType:"text",success:function(e){var t=JSON.parse(e);remitaUiCtrl.settings.allowEmail=t.responseData[0],"Y"===t.responseData[0].allowNoEmail?($(".email, .confirm-email").removeAttr("required"),$(".email, .confirm-email").siblings("label").find(".red-text").hide()):($(".email, .confirm-email").attr("required",!0),$(".email, .confirm-email").siblings("label").find(".red-text").show())},error:function(e){}})},showCustomFields:function(e){e.customFields.removeClass("hidden")},getHowDoYouWantToPayDb:function(e){var t=e,a=t.howDoYouWantToPay.val();switch(t.showHowDoYouWantToPayCustomFields.html(""),t.howDoYouWantToPay.removeClass("selected-bank-bg"),t.howDoYouWantToPay.removeClass("selected-remita-bg"),t.howDoYouWantToPay.removeClass("selected-bankbranch-bg"),t.howDoYouWantToPay.removeClass("selected-wallet-bg"),t.howDoYouWantToPay.removeClass("selected-mobilemoney-bg"),t.howDoYouWantToPay.removeClass("selected-foreign-bank-currency-bg"),a){case"CARD":"VERVE"==t.howDoYouWantToPay.find(":selected").text()?t.howDoYouWantToPay.addClass("verve-bank-bg"):t.howDoYouWantToPay.addClass("selected-bank-bg"),t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),t.howDoYouWantToPay.find(":selected").data("cancapture"),t.showHowDoYouWantToPayCustomFields.html(remitaUiCtrl.buildCardPaymentFormFields("","",t));break;case"REMITA":t.howDoYouWantToPay.addClass("selected-remita-bg"),t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),t.showHowDoYouWantToPayCustomFields.html(remitaUiCtrl.buildRemitaPaymentFormFields("",""));break;case"BANKBRANCH":t.howDoYouWantToPay.addClass("selected-bankbranch-bg"),t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),t.showHowDoYouWantToPayCustomFields.html(remitaUiCtrl.buildBankBranchPaymentFormFields());break;case"WALLET":t.howDoYouWantToPay.addClass("selected-wallet-bg"),t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),t.showHowDoYouWantToPayCustomFields.html(remitaUiCtrl.buildWalletPaymentFormFields());break;case"mobilemoney":t.howDoYouWantToPay.addClass("selected-mobilemoney-bg"),t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),t.showHowDoYouWantToPayCustomFields.html(remitaUiCtrl.buildMobileMoneyPaymentFormFields());break;case"foreigncurrencybanks":t.howDoYouWantToPay.addClass("selected-foreign-bank-currency-bg"),t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),t.showHowDoYouWantToPayCustomFields.html(remitaUiCtrl.buildForeignCurrencyBankFormFields());case"INTERNETBANKING":t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),remitaUiCtrl.buildInternetBankFields().then(function(e){t.showHowDoYouWantToPayCustomFields.html(e)});break;case"ACCOUNT":t.showHowDoYouWantToPayCustomFields.removeClass("hidden"),remitaUiCtrl.buildBankAccountFields().then(function(e){return t.showHowDoYouWantToPayCustomFields.html(e),servicesCtrl.getDataEndPointData("banklist/bank.json","otpBankLov").then(function(e){var a="";$.each(e.responseData,function(e,t){t.enabled&&"SELF_BANK"==t.regAuthType&&(a+="<option value='"+t.bankId+"'  data-otpenabled='"+t.enabled+"' data-regauthtype='"+t.regAuthType+"' > "+t.name+"</option>")}),t.showHowDoYouWantToPayCustomFields.find("#bankId").append(a)})})}},buildBankAccountFields:function(){var e=$.Deferred(),t='<div class="form-group">\t\t\t<label class="">Bank Name</label>\t\t\t<select type="text" class="form-control required" id="bankId" name="bankId" data-avs-bank="avsLookUp">\t\t\t\t<option value="" class="no-value">'+MESSAGE_BUNDLE["core.select.a.bank"]+'</option>\t\t\t</select>\t\t</div>\t\t<div class="form-group">\t\t\t<label class="">'+MESSAGE_BUNDLE["core.bank.account.number"]+'</label>\t\t\t<input type="text" class="form-control required" placeholder="Bank Account" data-avs-account="avsLookUp" name="bankAccount" id="bankAccount" required="required">\t\t</div>';return e.resolve(t),e.promise()},loadBanks:function(){var e=$.Deferred();return e.resolve([{code:"011",name:"First Bank"},{code:"032",name:"Union Bank"},{code:"033",name:"UBA"},{code:"044",name:"Access Bank"},{code:"050",name:"Eco Bank"},{code:"076",name:"Skye Bank"},{code:"070",name:"Fidelity Bank"},{code:"082",name:"Keystone Bank"},{code:"232",name:"Sterling Bank"},{code:"057",name:"Zenith Bank"},{code:"058",name:"GTBank"},{code:"214",name:"FCMB"},{code:"039",name:"Stanbic Bank"},{code:"063",name:"Diamond Bank"},{code:"215",name:"Unity Bank"},{code:"030",name:"Heritage Bank"},{code:"030",name:"Wema Bank"}]),e.promise()},buildCardPaymentFormFields:function(e,t,a){a.howDoYouWantToPay&&a.howDoYouWantToPay.addClass("selected-bank-bg");var r="";return r+="<div col-md-12>",r+="</div>",r+='<div class="form-group col-md-12" style="padding:0px">',r+='<label for="name">Card Holder Name</label>',r+='<input type="text" class="form-control '+e+'" data-errlabel="card holder name"  name="cardHolder" id="cardHolder" placeholder="Card Holder Name" style="'+t+'" required="required" >',r+="</div>",r+='<div class="form-group col-md-6" style="padding:0px">',r+='<label for="name">Card Number</label>',r+='<input type="text" class="form-control '+e+'" data-errlabel="card number card_number" name="card_number" data-card-id id="card_number" placeholder="1234 5678 9012 3456" style="display: block; width: 100%; color: #555555 !important;" required="required" >',r+="</div>",r+='<div class="form-group col-md-4">',r+='<label for="name">Expiry Date</label>',r+='<input type="text" class="form-control '+e+'" data-errlabel="expiry date" name="expiringDate" id="expiringDate" placeholder="mm/yy" style="'+t+'" required="required"  >',r+="</div>",r+='<div class="form-group col-md-2" style="padding:0px">',r+='<label for="name">CVV</label>',r+='<input maxlength="3" type="password" class="form-control '+e+'" data-errlabel="cvv" name="cvv" id="cvc" placeholder="CVV" style="'+t+'" required="required" >',r+="</div>"},buildBankBranchPaymentFormFields:function(){return'<span id="bankBranches" style="cursor: pointer;color: ##77A600;">CLICK TO VIEW AVAILABLE BANK BRANCHES ></span>'},buildMobileMoneyPaymentFormFields:function(){var e="";return e+='<div class="form-group col-md-12" style="padding:0px">',e+='<select id="selectBank"  class="form-control selectpicker" data-show-subtext="true" data-live-search="true">',e+=' <option value="">'+MESSAGE_BUNDLE["core.select.your.mobile.money.provider"]+"</option>",e+='<option value="United States">GTEazySavers ** Available only to Etisalat subscribers</option>',e+="<select>"},buildWalletPaymentFormFields:function(){var e="";return e+='<div class="form-group col-md-12" style="padding: 0px">',e+='<select id="selectWallet"  class="form-control selectpicker" data-show-subtext="true" data-live-search="true">',e+=' <option value="">'+MESSAGE_BUNDLE["core.select.your.wallet.provider"]+"</option>",e+='<option value="page">Paga</option>',e+="<select>"},buildRemitaPaymentFormFields:function(){return""},buildInternetBankFields:function(){var e="";return servicesCtrl.getDataEndPointData("ibanklov.json","internetBankLov").then(function(t){return e+='<div class="form-group col-md-12" style="padding:0px">',e+='<select id="selectInternetBank"  class="form-control selectpicker" data-show-subtext="true" data-live-search="true">',$.each(t.responseData,function(t,a){null!=a.url&&"null"!=a.url&&(e+='<option value="'+a.url+'" data-bId="'+a.id+'">'+a.description+"</option>")}),e+="<select></div>"})},buildForeignCurrencyBankFormFields:function(){var e="";e="";return e+='<div class="form-group col-md-12" style="padding: 0px">',e+='<select id="foreignCurrencyBank"  class="form-control selectpicker" data-show-subtext="true" data-live-search="true">',e+=' <option value="">'+MESSAGE_BUNDLE["core.select.your.bank"]+"</option>",e+='<option value="zenth bank">Zenth Bank</option>',e+="<select>"},buildFormDate:function(e,t,a,r,o,n){"Y"==a?(n.req="required",n.reqSpan='<span style="color:#ff0000!important"> * </span>'):(n.req="",n.reqSpan="");var i="";return i='<div class="form-group">',i+='<label for="'+e+'">'+t+"</label>",i+='<input id="date'+e+'" placeholder="yyyy/dd/mm" size="16" type="text"  readonly class="form-control form_date '+r+'" data-errlabel="'+t+'" name="'+t+'_D" id="'+e+'" style=" background: #fff !important; cursor: pointer !important; line-height: 12px; '+o+'" '+n.req+">",i+="</div>"},showFormErrors:function(e){$(".float-left-div").removeClass("hidden"),$("#error-div").removeClass("animated zoomIn visible"),$("#showServiceCharge").addClass("hidden"),$("#error-div").removeClass("hidden"),$("#error-div").addClass("animated zoomIn visible"),$("#error-div-instructionTitle").html("Error(s)"),$("#error-div-instructionMsg").html(""),$("#error-div-instructionMsg").html(e),$("#error-div-instructionTitle").prop("style","color:#fff !important;margin-bottom:0px;letter-spacing:5px;text-transform: uppercase;"),$("#error-div-instructionTitleDiv").prop("style","background: #f00 !important;font-weight:40px !important;padding:15px !important;")},hideFormErrors:function(){$(".float-left-div").addClass("hidden"),$("#error-div").addClass("hidden"),$(":input").removeClass("error"),$(":input").removeClass("form-error")},validateIntegrationServiceTypes:function(e,t,a,r,o){var n,i,s=5;if("D"==r&&"Y"==a){var l=t.match(/^http/)?t:"//"+t,d=MESSAGE_BUNDLE.getKey("core.payment.in.favor.of.biller",{billername:e,url:l});$("#modal-int").on("shown.bs.modal",function(t){$(this);$("#int-name").html(e),$("#int-msg").html(d),$("#int-msg").append('<p class="countdownTimer">You will be redirected in '+s+" seconds</p><p>Click cancel or Close modal to prevent redirection</p>"),n=setTimeout(function(){window.location.open(l,"_blank")},5e3),i=setInterval(function(){var e=s<=0?"Redirecting...":"You will be redirected in "+s--+" seconds";$(".countdownTimer").html(e)},1e3)}),$("#modal-int").on("hide.bs.modal",function(e){clearTimeout(n),clearInterval(i),s=5}),$("#modal-int").modal({backdrop:"static",keyboard:!1}),$("#"+o).find("option[value='id']").prop("selected",!0)}},buildFormInput:function(e,t,a,r,o,n,i,s,l){"Y"==r?(s.req="required",s.reqSpan='<span style="color:#ff0000!important"> * </span>'):(s.req="",s.reqSpan="");var d="";return d='<div class="form-group">',d+='<label for="'+t+'">'+a+" "+s.reqSpan+"</label>",d+='<input onKeyPress="return validateCusInput(this);" onkeyup="return validateCusInput(this);" onblur="return validateCusInput(this);"  data-colltype="'+i+'" type="'+e+'" class="form-control '+o+'" data-errlabel="'+a+'" maxlength="'+l+'" name="'+a+"_"+i+'" id="'+t+'" placeholder="'+a+'" style="'+n+'" '+s.req+" >",d+="</div>"},serviceCustomFieldsLoader:function(e,t,a,r,o,n){var i="",s="",l=o.required;null!=o.validateRule&&"Y"==o.validateRule.validationFlag&&(i="validateUrl"),null!=o.dataLoadRuleId&&o.dataLoadRuleId>0&&(s="Y"==o.primary?"dataloadrule primary":"dataloadrule");var d,c=i+" "+s,m=e;switch(a){case"DD":"Y"==l?(e.req="required",e.reqSpan='<span style="color:#ff0000!important"> * </span>'):(e.req="",e.reqSpan=""),d="",d+='<div class="form-group">',d+='<label for="'+o.id+'">'+o.columnName+" "+e.reqSpan+"</label>",d+='<select class="form-control  '+i+" "+s+'" name="'+o.columnName+'_DD" id="'+o.id+'" data-errlabel="'+o.columnName+'" data-errlabel="'+o.columnName+'" '+e.req+">",$.each(o.customFieldDropDown,function(e,t){d+='<option value="'+t.ID+'">'+t.DESCRIPTION+"</option>"}),d+="</select>",d+="</div>",t.append(d);break;case"AC":"Y"==l?(e.req="required",e.reqSpan='<span style="color:#ff0000!important"> * </span>'):(e.req="",e.reqSpan=""),d="",d+='<div class="form-group">',d+='<label for="'+o.id+'">'+o.columnName+" "+e.reqSpan+"</label>",d+='<input type="text" class="form-control customFieldDropDown" id="'+o.id+'"  name="'+o.columnName+'_AC"  placeholder="Search here"  required style="width:100% !important">',d+="</div>",t.append(d);var u=$("#"+o.id).attr("id"),p=$("#nameOfServiceOrPurpose").val(),v=$("#"+o.id).val();$("#"+u).keypress(function(e){remitaUiCtrl.autoCompleteForCustomField(u,v,p)});break;case"SL":"Y"==l?(e.req="required",e.reqSpan='<span style="color:#ff0000!important"> * </span>'):(e.req="",e.reqSpan=""),d="",d+='<div class="form-group">',d+='<label for="'+o.id+'">'+o.columnName+" "+e.reqSpan+"</label>",d+='<select class="form-control sl-items selectmpickera  '+i+" "+s+'" name="'+o.columnName+'_SL" id="'+o.id+'"  data-errlabel="'+o.columnName+'" '+e.req+"  multiple >",$.each(o.customFieldDropDown,function(e,t){d+='<option value="'+t.ID+'" id="'+t.ID+'">'+t.DESCRIPTION+"</option>"}),d+="</select>",d+="</div>",t.append(d),$(".selectmpickera").multiselect("rebuild");break;case"SP":m.itemTotal.prop("readonly","readonly"),d="",d+='<div class="form-group">',d+='<label for="'+o.id+'" data-columnSP="'+o.id+'" class"'+s+'">'+o.columnName+"</label>",d+='<table class="table table-condensed sp-items-table sp-list-table-'+o.id+'" id="sp-list-table">',d+="<thead>",d+="<tr>",d+="<th>item</th>",d+="<th>Unit Price</th>",d+="<th>Qty</th>",d+="<th>Price </th>",d+="</tr>",d+="</thead>",d+="<tbody>",$(o.customFieldDropDown).each(function(e,t){d+="<tr>";var a="checkbox";"Y"==o.singleSelect&&(a="radio"),"true"==t.FIXEDPRICE?(d+='<td><input id="'+t.ID+'" class="sp-items" name="sp-item[]" type="'+a+'" value="'+t.UNITPRICE+'" data-price="'+t.UNITPRICE+'" data-code="'+t.CODE+'" data-description="'+t.DESCRIPTION+'" data-fixedprice="'+t.FIXEDPRICE+'"  data-columnname="'+o.columnName+'" /> '+t.DESCRIPTION+"</td>",d+="<td>"+remitaUiCtrl.formatCurrency(t.UNITPRICE)+"</td>",d+='<td><input type="number" id="'+t.ID+'-qty" class="sp-items" name="sp-item-price" type="number" style="width:45px" min="0" max="99999" disabled/></td>'):"false"==t.FIXEDPRICE&&(d+='<td><input id="'+t.ID+'" class="sp-items" name="sp-item[]" type="'+a+'" data-code="'+t.CODE+'" data-description="'+t.DESCRIPTION+'" data-fixedprice="'+t.FIXEDPRICE+'"  data-columnname="'+o.columnName+'" /> '+t.DESCRIPTION+"</td>",d+='<td><input type="number" class="sp-items" id="'+t.ID+'-up" disabled/></td>',d+='<td><input type="number" id="'+t.ID+'-qty" class="sp-items" name="sp-item" type="number" style="width:45px" min="0" max="99999"  disabled/></td>'),d+='<td class="'+t.ID+'-pricePerQty sumTotal4AllItems"></td>',d+="</tr>"}),d+="</tbody>",d+="<tfoot>",d+='<tr> <td></td> <td></td> <td>Your Total</td> <b> <td id="'+n+'" style="background:#f2f2f2;"></td></b> </tr>',d+="</tfoot>",d+="</table>",d+="</div>",t.append(d);break;case"D":t.append(remitaUiCtrl.buildFormDate(o.id,o.columnName,l,c,"",m)),$("#date"+o.id).daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD-MM-YYYY"}});break;case"A":t.append(remitaUiCtrl.buildFormInput("text",o.id,o.columnName,l,c+" alpha","","A",m,o.columnLength));break;case"AN":t.append(remitaUiCtrl.buildFormInput("text",o.id,o.columnName,l,c+" alphanumber","","AN",m,o.columnLength));break;case"ALL":t.append(remitaUiCtrl.buildFormInput("text",o.id,o.columnName,l,c,"","ALL",m,o.columnLength));break;case"N":t.append(remitaUiCtrl.buildFormInput("text",o.id,o.columnName,l,c,"","N",m,o.columnLength))}},checkForFixedPrice:function(e,t,a){this.settings;t.fixedPrice&&(e.val(remitaUiCtrl.formatCurrency(t.fixedAmount)),e.prop("placeholder",remitaUiCtrl.formatCurrency(t.fixedAmount)),e.val(remitaUiCtrl.formatCurrency(t.fixedAmount)),e.prop("readonly","readonly"))},checkForFixedCurrency:function(e,t){var a=t;a.selectCurrency.find("option").each(function(t,r){$(r).attr("data-code")==e.currencyCode&&(a.selectCurrency.prop("selectedIndex",t),$(r).prop({selected:!0}).change(),remitaUiCtrl.loadCurrencySign(a),a.selectCurrency.prop("disabled",!0))})},setNairaAsDefualt:function(e){var t=e;t.selectCurrency.find("option").each(function(e,a){$(a).attr("data-code")==MESSAGE_BUNDLE["core.currency.code"]&&(t.selectCurrency.prop("selectedIndex",e),$(a).prop({selected:!0}).change())})},getSPItemsOnBlur:function(e,t){var a=e;a.docReady.on("change",".sp-items",function(){a.docReady.sumItemPrice=0,$("#"+$(this).attr("id")+"-qty").val("1"),$(".sp-items").each(function(){$(this).is("#"+$(this).attr("id")+":checked")?($("#"+$(this).attr("id")+"-qty").removeAttr("disabled"),$("#"+$(this).attr("id")+"-qty").prop("min",1),$(this).attr("data-price")?(a.docReady.itemPrice=parseFloat($(this).data("price"))*$("#"+$(this).attr("id")+"-qty").val(),a.docReady.sumItemPrice+=a.docReady.itemPrice,$("."+$(this).attr("id")+"-pricePerQty").text(remitaUiCtrl.formatCurrency(a.docReady.itemPrice))):($("#"+$(this).attr("id")+"-up").removeAttr("disabled"),$("#"+$(this).attr("id")+"-qty").removeAttr("disabled"),a.docReady.itemPrice=$("#"+$(this).attr("id")+"-up").val()*$("#"+$(this).attr("id")+"-qty").val(),a.docReady.sumItemPrice+=a.docReady.itemPrice,$("."+$(this).attr("id")+"-pricePerQty").text(remitaUiCtrl.formatCurrency(a.docReady.itemPrice)))):($("#"+$(this).attr("id")+"-up").prop("disabled",!0),$("#"+$(this).attr("id")+"-qty").prop("disabled",!0),$("#"+$(this).attr("id")+"-qty").prop("min",0),$("#"+$(this).attr("id")+"-qty").val(0),$("#"+$(this).attr("id")+"-up").val(""),$("."+$(this).attr("id")+"-pricePerQty").text("0.00"))});var e=remitaUiCtrl.formatCurrency(a.docReady.sumItemPrice);$("#"+t).html(e),a.itemTotal.attr("placeholder",e),a.itemTotal.val(e),$("#totalAmoutToPay2").prop("value",a.docReady.sumItemPrice)})},calculateTotal:function(e,t){var a=0,r=$("#total_potential");$("#sp-list-table input:checkbox:checked").each(function(e,t){var o=t.id,n=$("#"+o+"-qty").val(1),i=$("#"+o+"-up").val(),s=$("."+o+"-pricePerQty");try{n=parseInt(n)}catch(e){n=0}try{i=parseInt(i)}catch(e){i=0}if(n>0&&i>0){var l=i*n;a+=l,s.text(remitaUiCtrl.formatCurrency(l))}r.text(remitaUiCtrl.formatCurrency(a))})},getSLItemsOnBlur:function(e){var t=e;t.docReady.on("change","#sl-items",function(){$("#show_box, #total_box").empty(),t.sumItemPrice=0,t.itemPrice,$(this).find("option:selected").each(function(){$(this).attr("data-price")&&(t.itemPrice=$(this).data("price"),t.sumItemPrice+=t.itemPrice,$("#show_box").append("<h6>"+remitaUiCtrl.formatCurrency(t.itemPrice)+"</h6>"))}),$("#total_box").text(remitaUiCtrl.formatCurrency(t.sumItemPrice))})},getAcceptDirectDebit:function(e){"N"==e?($("#recurringPaymentType").find("option[value=SO]").prop("selected",!0).change(),$("#recurringPaymentType").prop("disabled",!0)):($("#recurringPaymentType").find("option[value=DD]").prop("selected",!0).change(),$("#recurringPaymentType").removeAttr("disabled"))},showLoading:function(){$("#loading").removeClass("hidden"),$("#loading").html('<i class="fa fa-spinner fa-pulse fa-2x fa-fw margin-bottom"></i><span >'+MESSAGE_BUNDLE["core.loading.data"]+"</span>"),$("#submitStandinOrder").prop("disabled","disabled")},hideLoading:function(){$("#loading").addClass("hidden"),$("#loading").html("")},loadCustomBillerServiceTypeForms:function(e,t,a){var r=$.Deferred(),o=e,n="",i="";""!=a?(i=a.specificService,n=a.specificUrl+i+"/rrr.json"):n="bill/details/"+(i=o.serviceTypeId)+"/rrr.json",o.customFields.html(""),$("#hideServiceChargeDiv").addClass("hidden");var s=servicesCtrl.getLocalData(i);if($("#theamountiwanttopayDiv").addClass("hidden"),s){"Y"===s.acceptBuyOnCredit?remitaUiCtrl.settings.acceptBuyOnCredit=!0:remitaUiCtrl.settings.acceptBuyOnCredit=!1,""!=a&&($("#whoDoYouWantToPayId").prop("value",s.billerId),$("#billerName").addClass("hidden"),$("#pageTitle").addClass("hidden"),s.responseData[0]&&$("#whoDoYouWantToPay").prop("value",s.responseData[0].companyName),$("#whoDoYouWantToPay").prop("readonly","readonly"),$("#nameOfServiceOrPurpose").prop("readonly","readonly"),s.responseData[0]?$("#nameOfServiceOrPurpose").append('<option value="'+s.serviceTypeId+'" data-uploadtype="'+s.uploadType+'">'+s.responseData[0].description+"</option>"):pageSettings.serviceDetailId&&pageSettings.serviceDetailDescription&&$("#nameOfServiceOrPurpose").append('<option value="'+pageSettings.serviceDetailId+'" selected>'+pageSettings.serviceDetailDescription+"</option>"),$("#collectorId").prop("value",s.billerId),$(".serviceTypeId").prop("value",s.serviceTypeId)),s.billerId&&s.serviceTypeId&&(!0===pageSettings.isServiceType||"true"===pageSettings.isServiceType)&&(remitaUiCtrl.getBillersLogoAndConvertBase64ToImage(s.billerId,o),remitaUiCtrl.getSpecificBillerName(s.billerId,o),pageSettings.serviceDetailId&&pageSettings.serviceDetailDescription&&remitaUiCtrl.handleOneServiceCardDisplay([{name:pageSettings.serviceDetailDescription,value:pageSettings.serviceDetailId}],o),$("#hidenameOfServiceOrPurpose").removeClass("hidden"),$(".service-type-card").addClass("active"));s.acceptDirectDebit;"Y"==s.acceptPartPayment&&$("#theamountiwanttopayDiv").removeClass("hidden"),remitaUiCtrl.getAcceptDirectDebit(s.acceptDirectDebit),remitaUiCtrl.checkForFixedPrice(o.itemTotal,s,i),remitaUiCtrl.checkForFixedCurrency(s,o),$.each(s.responseData,function(e,a){o.columnType=a.columnType,remitaUiCtrl.serviceCustomFieldsLoader(o,o.customFields,o.columnType,e,a,t)}),r.resolve(!0)}else $.ajax({url:o.apiURL+n,dataType:"text",success:function(e){remitaUiCtrl.hideFormErrors();var n=servicesCtrl.remitaDecode(e);if("00"==n.responseCode){"Y"===n.acceptBuyOnCredit?remitaUiCtrl.settings.acceptBuyOnCredit=!0:remitaUiCtrl.settings.acceptBuyOnCredit=!1,pageSettings.serviceDetailId&&o.nameOfServiceOrPurpose.val(pageSettings.serviceDetailId),n.billerId&&n.serviceTypeId&&(!0===pageSettings.isServiceType||"true"===pageSettings.isServiceType)&&(remitaUiCtrl.getBillersLogoAndConvertBase64ToImage(n.billerId,o),remitaUiCtrl.getSpecificBillerName(n.billerId,o),pageSettings.serviceDetailId&&pageSettings.serviceDetailDescription&&remitaUiCtrl.handleOneServiceCardDisplay([{name:pageSettings.serviceDetailDescription,value:pageSettings.serviceDetailId}],o),$("#hidenameOfServiceOrPurpose").removeClass("hidden"),$(".service-type-card").addClass("active")),"Y"==n.acceptPartPayment&&$("#theamountiwanttopayDiv").removeClass("hidden"),""!=a&&($("#whoDoYouWantToPayId").prop("value",n.billerId),n.responseData[0]&&$("#whoDoYouWantToPay").prop("value",n.responseData[0].companyName),$("#billerName").addClass("hidden"),$("#pageTitle").addClass("hidden"),$("#whoDoYouWantToPay").prop("disabled","disabled"),$("#nameOfServiceOrPurpose").prop("disabled","disabled"),n.responseData[0]?$("#nameOfServiceOrPurpose").append('<option value="'+n.serviceTypeId+'" data-uploadtype="'+n.uploadType+'" selected>'+n.responseData[0].description+"</option>"):pageSettings.serviceDetailId&&pageSettings.serviceDetailDescription&&$("#nameOfServiceOrPurpose").append('<option value="'+pageSettings.serviceDetailId+'" selected>'+pageSettings.serviceDetailDescription+"</option>"),$("#collectorId").prop("value",n.billerId),$(".serviceTypeId").prop("value",n.serviceTypeId));var s=n.acceptDirectDebit;remitaUiCtrl.getAcceptDirectDebit(s),servicesCtrl.setLocalData(i,n),remitaUiCtrl.checkForFixedPrice(o.itemTotal,n,i),remitaUiCtrl.checkForFixedCurrency(n,o),$.each(n.responseData,function(e,a){o.columnType=a.columnType,remitaUiCtrl.serviceCustomFieldsLoader(o,o.customFields,o.columnType,e,a,t)}),r.resolve(!0)}else $("#processingInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]),r.reject(!1)},complete:function(){o.nameOfServiceOrPurpose.removeClass("ui-autocomplete-loading")},error:function(){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}});return remitaUiCtrl.showCustomFields(o),r.promise()},loadBillersAutoComplete:function(e){var t=e;if("true"==t.isSpecificBiller)var a=servicesCtrl.getLocalData(t.billerCode);else a=servicesCtrl.getLocalData("billers");t.whoDoYouWantToPay.easyAutocomplete({data:a,listLocation:"responseData",getValue:function(e){return e.label},list:{maxNumberOfElements:30,match:{enabled:!0},onChooseEvent:function(){remitaUiCtrl.hideFormErrors(),t.customFields.html(""),e.nameOfServiceOrPurpose.html(""),e.nameOfServiceOrPurpose.closest(".form-group").find(".service-type-cards-holder .service-row").html(""),t.billerName.removeClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#submit").removeClass("hidden"),$("#payersEmail").val(""),$("#itemTotal").val(""),$("#payersFullName").val(""),$("#payersPhone").val(""),$("#payersFullName").prop("readonly",!1),$("#itemTotal").prop("readonly",!1),$("#payersEmail").prop("readonly",!1),$("#payersPhone").prop("readonly",!1),$("input").removeClass("form-error"),t.selectedBillerId=t.whoDoYouWantToPay.getSelectedItemData().id,t.whoDoYouWantToPayId.attr("value",t.selectedBillerId),remitaUiCtrl.resetItemAmountInputValues(t),t.billerName.html('<h3  style="margin-bottom: 0px !important; padding-top: 10px !important; font-size:18px">'+t.whoDoYouWantToPay.getSelectedItemData().label+"</h3>"),$("#uploadType").addClass("hidden"),remitaUiCtrl.getBillersLogoAndConvertBase64ToImage(t.selectedBillerId,t),remitaUiCtrl.getBillerServicesById(t.selectedBillerId,t)},onShowListEvent:function(){t.whoDoYouWantToPay.removeClass("ui-autocomplete-loading")},onLoadEvent:function(){t.whoDoYouWantToPay.removeClass("ui-autocomplete-loading")}}})},loadCustomFieldAutoComplete:function(e,t){$("#"+t).easyAutocomplete({data:e,getValue:function(e){return e.DESCRIPTION},list:{maxNumberOfElements:30,match:{enabled:!0},onChooseEvent:function(){$("#"+t).attr("data-cfid",$("#"+t).getSelectedItemData().ID),$("#"+t).attr("name",$("#"+t).attr("name")+"_"+$("#"+t).getSelectedItemData().ID),$("#"+t).data("auto-key",$("#"+t).getSelectedItemData().ID)},onShowListEvent:function(){},onLoadEvent:function(){}}})},checkEmailConfirmation:function(e){return e.email.val()==e.email_confirm.val()},autoCompleteForCustomField:function(e,t,a){var r=this.settings.apiURL+"custom-field/"+a+"/"+e+"/search.json?searchParam="+t;servicesCtrl.getDataEndForCustomField(r,"cus_search_"+e).then(function(t){this.settings;$("#"+e).easyAutocomplete({data:t,getValue:function(e){return e.DESCRIPTION},list:{maxNumberOfElements:30,match:{enabled:!0},onChooseEvent:function(){var t=$("#"+e).getSelectedItemData().ID;$("#"+e).attr("data-selected",t),$("#"+e).data("auto-key",$("#"+e).getSelectedItemData().ID)},onShowListEvent:function(){},onLoadEvent:function(){}}})},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])})},validateDataLoadRule:function(e,t,a){a||$("#customFields").find(".dataloadrule");var r=this.settings;$("#submit").removeClass("hidden");var o;o={serviceId:e,val:t,customFieldId:a};var n=servicesCtrl.remitaEncode(JSON.stringify(o));$.ajax({url:r.apiURL+"validateDataLoadRule.json",type:"POST",dataType:"text",data:n,headers:{"Content-Type":"application/json; charset=utf-8"},success:function(e){var t=servicesCtrl.remitaDecode(e);if("00"==t.responseCode)if("OK"==t.responseData[0].status||"ok"==t.responseData[0].status){$("#error-div").addClass("hidden");var a=t.responseData[0].itemTotal;null!=a&&void 0!=a&&"undefined"!=$.type(a)&&"null"!=$.type(a)&&"null"!=$.trim(a)&&"undefined"!=$.trim(a)&&""!=$.trim(a)&&0!=parseFloat($.trim(a))?($("#itemTotal").val(a),$("#itemTotal").text(a),$("#amountDue").text(remitaUiCtrl.formatCurrency(a)),$("input#itemTotal").blur(),$("#itemTotal").prop("readonly",!0)):$("#itemTotal").prop("readonly",!1);var r=t.responseData[0].payersFullName;null!=r&&void 0!=r&&"undefined"!=$.type(r)&&"null"!=$.type(r)&&"null"!=$.trim(r)&&"undefined"!=$.trim(r)&&""!=$.trim(r)?($("#payersFullName").val(r),$("#payersFullName").prop("readonly",!0),$("input#payersFullName").blur()):$("#payersFullName").prop("readonly",!1);var o=t.responseData[0].payersEmail;null!=o&&void 0!=o&&"undefined"!=$.type(o)&&"null"!=$.type(o)&&"null"!=$.trim(o)&&"undefined"!=$.trim(o)&&""!=$.trim(o)?($("#payersEmail").val(o),$("#payersEmail").prop("readonly",!0),$("input#payersEmail").blur()):$("#payersEmail").prop("readonly",!1);var n=t.responseData[0].payersPhone;null!=n&&void 0!=n&&"undefined"!=$.type(n)&&"null"!=$.type(n)&&"null"!=$.trim(n)&&"undefined"!=$.trim(n)&&""!=$.trim(n)?($("#payersPhone").val(n),$("#payersPhone").prop("readonly",!0),$("input#payersPhone").blur()):$("#payersPhone").prop("readonly",!1),$.each(t.responseData[0],function(e,t){if(void 0!=$("#"+e)[0]&&"undefined"!=$("#"+e)[0]){var a=$("#"+e)[0].nodeName;$("#"+e).attr("type");if("INPUT"==a)$("#"+e).prop("value",t),$("#"+e).prop("readonly",!0);else if("SELECT"==a)$("#"+e+" option").filter(function(){return this.text.toLowerCase()==t.toLowerCase()}).attr("selected",!0),$("#"+e).prop("readonly",!0);else{var r=t.split(",");$.each(r,function(t,a){$(".sp-list-table-"+e).find("input[type='checkbox'][data-code='"+a+"']").prop("checked",!0).change()})}}})}else $("#submit").addClass("hidden"),remitaUiCtrl.showFormErrors(t.responseData[0].message);else $("#submit").addClass("hidden"),remitaUiCtrl.showFormErrors(t.responseData[0].message)},error:function(e){},complete:function(){}})},validateUrl:function(e,t,a){var r,o,n=this.settings;o={serviceId:e,val:t,customFieldId:a};var i=servicesCtrl.remitaEncode(JSON.stringify(o));return $.ajax({url:n.apiURL+"validateRule.json",type:"POST",dataType:"text",data:i,headers:{"Content-Type":"application/json; charset=utf-8"},success:function(e){var t=servicesCtrl.remitaDecode(e);r="00"==t.responseCode&&("OK"==t.responseData[0].status||"ok"==t.responseData[0].status)},error:function(e){r=!1},complete:function(){}}),r}};$(function(){remitaUiCtrl.init(pageSettings),remitaUiCtrl.loadSessions(),remitaCaptcha.init(),remitaUiCtrl.initTooltips()});var payOnceCtrl={settings:{whoDoYouWantToPay:$("#whoDoYouWantToPay"),whoDoYouWantToPayId:$("#whoDoYouWantToPayId"),itemTotal:$("#itemTotal"),nameOfServiceOrPurpose:$("#nameOfServiceOrPurpose"),selectCurrency:$("#selectCurrency"),totalAmoutToPay2EndPoint:$("#totalAmoutToPay2"),customFields:$("#customFields"),output:$("#output"),howDoYouWantToPay:$("#howDoYouWantToPay"),showHowDoYouWantToPayCustomFields:$("#showHowDoYouWantToPayCustomFields"),showPayerInstitution:$("#showPayerInstitution"),billerName:$("#billerName"),billerLogo:$("#billerLogo"),serviceChargeSpan:$("#serviceCharge .serviceCharge"),cvFeeSpan:$("#cvFee .cvFee"),serviceVatFee:$(".serviceVATFEE"),totalAmountToBePaySpan:$("#totalAmoutToPay .totalAmoutToPay"),serviceCharge:$("#serviceCharge"),showServiceCharge:$("#showServiceCharge"),totalAmoutToPay:$("#totalAmoutToPay"),modelSu:$("#ifrdiv"),setCurrencySign:$(".setCurrencySign"),subTotal:$("#subTotalSpan"),instruction:$("#instruction"),captchaInput:$("#captchaInput"),captchaError:$(".captchaError"),submitButton:$("#submit"),mainForm:$("#mainForm"),CustomForm:$("#CustomForm"),email:$("#payersEmail"),email_confirm:$("#payersEmail_confirm"),paymentDetails:$("#paymentDetails"),total_potential:$("#total_potential"),selectWallet:$("#selectWallet"),selectedBillerId:null,banklovUrl:"banklovall.json",req:null,docReady:$(document),reqSpan:null,sumItemPrice:null,itemPrice:null,ischecked:!1,serviceTypeId:null,columnType:null,integratorURL:null,integratorType:null,integratorAllowintservice:null,paymentType:"payOnce",amount:$('[name="amount"]')},init:function(e){this.settings=$.extend(payOnceCtrl.settings,e);var t=this.settings,a=t.rt,r=t.rrrToPay;if(1==a&&(eInvoiceCtrl.activate(),$("#main-content").show(),$("#hideServiceChargeDiv").addClass("hidden"),$("#main-content-invoice").addClass("hidden"),$("#clickEInvoice").click(),$('.tabs-navigation a[href="#eInvoice"]').tab("show"),eInvoiceCtrl.reloadInvoiceView(r)),$("#modal-su").on("hide.bs.modal",function(){$("#ifrdiv").html(""),1==a&&grecaptcha.reset(widgetId1)}),t.isServiceType||"true"==t.isServiceType){$("#hideWhoDoYouWantToPay").addClass("hidden"),$("#hidenameOfServiceOrPurpose").addClass("hidden"),$("#whoDoYouWantToPay").prop("readonly",!0),$("#nameOfServiceOrPurpose").prop("readonly",!0);var o={specificService:t.specificServiceType,specificUrl:"bill/details/"};remitaUiCtrl.getServiceTypeOnchange(t,"total_potential",o).then(function(){if(t.hasPayerReference||"true"==t.hasPayerReference){var e=$("#customFields").find(".dataloadrule");if(""!=t.specificServiceAmount&&($("#itemTotal").val(t.specificServiceAmount).prop("readonly",!0),$("#selectCurrency").attr("disabled",!0)),e.hasClass("primary")){var a=t.payerReference,r=e.attr("id");e.val(a),e.prop("readonly",!0);var o=t.specificServiceType;""!=a&&remitaUiCtrl.validateDataLoadRule(o,a,r)}else remitaUiCtrl.showFormErrors("invalid record"),$("#submit").addClass("hidden")}"Y"==t.nameOfServiceOrPurpose.find(":selected").data("uploadtype")?($("#uploadType").removeClass("hidden"),$("#nameOfServiceOrPurpose").trigger("change")):$("#uploadType").addClass("hidden")})}else if(t.isSpecificBiller||"true"==t.isSpecificBiller){var n=t.billerCode;store.remove("_SPECS_PAYMENT_"+n)}else{n="billers";$("#FNF").data("fnf")?$("#pageTitle").html(MESSAGE_BUNDLE["core.pay.family.and.friends"]):$("#pageTitle").html(MESSAGE_BUNDLE["core.pay.a.biller"])}servicesCtrl.getDataEndPointData(t.billerUrl,n).then(function(e){if(e.responseData.length>0)remitaUiCtrl.loadBillersAutoComplete(t);else if(0===e.responseData.length&&"true"==t.isSpecificBiller){var a=t.billerCode;return remitaUiCtrl.getSpecificBillerName(a,t),remitaUiCtrl.getBillerServicesById(a,t),remitaUiCtrl.getBillersLogoAndConvertBase64ToImage(a,t),$("#whoDoYouWantToPayId").val(a),!0}},function(e){return!1}),remitaUiCtrl.setNairaAsDefualt(t),remitaUiCtrl.getSPItemsOnBlur(t,"total_potential"),remitaUiCtrl.getSLItemsOnBlur(t),servicesCtrl.getDataEndPointData(t.banklovUrl,"banklov").then(function(){remitaUiCtrl.loadFnFBankLov("#getBenMFB")},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}),servicesCtrl.getDataEndPointData(t.banklovUrl,"banklov").then(function(){remitaUiCtrl.loadFnFBankLov("#getBenMFBStandinOrder")},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}),servicesCtrl.getDataEndPointData(t.banklovUrl,"banklov").then(function(){remitaUiCtrl.loadFnFBankLov("#getMFBPayer")},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}),$(document).on("blur","#card_number",function(){if(1==$("#howDoYouWantToPay").find(":selected").data("cancapture")){$("#howDoYouWantToPay").removeClass("form-error");var e=$("#itemTotal").val(),a=$("#payersEmail").val(),r=$("#howDoYouWantToPay").val(),o=$("#selectCurrency").find(":selected").data("code"),n=$("#card_number").val().replace(/\s/g,""),i=$("#nameOfServiceOrPurpose").val();remitaUiCtrl.getServiceChargeNew(i,e,o,r,n,"","",a,t)}}),$(document).on("change","#nameOfServiceOrPurpose",function(){$("#collectorId").prop("value",$("#whoDoYouWantToPayId").val()),$(".serviceTypeId").prop("value",$("#nameOfServiceOrPurpose").val()),remitaUiCtrl.getServiceTypeOnchange(t,"total_potential","")}),t.docReady.on("change","#selectCurrency",function(){remitaUiCtrl.loadCurrencySign(t)}),t.docReady.on("blur","#captchaInput",function(){var e=JSON.parse(sessionStorage.cridValuePayOnce).crid,a=remitaUiCtrl.removeCaptchaInputSpace(t.captchaInput.val());remitaUiCtrl.checkCaptchaAnswerOnBlur(a,e,t)}),t.docReady.on("click","#formReset",function(){remitaUiCtrl.resetForms(t),$("#submit").removeClass("hidden"),$("#showHowDoYouWantToPayCustomFields").addClass("hidden"),$("#customFields").addClass("hidden"),$("input").val(""),$("input").removeClass("form-error"),$("input").removeClass("error")}),t.docReady.on("click","#submit",function(e){e.preventDefault();var t=payOnceCtrl.settings;$("#error-div").addClass("hidden");var a=$("#FNF").data("fnf");if(a)var r=$("#mainForm").valid(),o=$("#paymentDetails").valid();else{r=$("#mainForm").valid();var n=$("#CustomForm").valid(),i=(o=$("#paymentDetails").valid(),$("#myForm").valid())}var s=$("#nameOfServiceOrPurpose").val();if($("#CustomForm").find(":input").each(function(e,t){if($(t).hasClass("validateUrl")){var a=$(t).val(),r=$(t).attr("id");$(t).attr("placeholder");!0;remitaUiCtrl.validateUrl(s,a,r)}}),0==remitaUiCtrl.checkEmailConfirmation(t))remitaUiCtrl.showFormErrors("Please confirm your email address");else if(""==$(".itemTotal").val())remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]);else{if(a)var l=r&&o;else l=r&&n&&o&&i;if(l)remitaUiCtrl.checkForEmptyInput()||($("#itemTotal").removeClass("form-error"),$(":input").removeClass("form-error"),remitaCaptcha.checkCaptchaAnswer(grecaptcha.getResponse(widgetId1)).then(function(e){if(e){$("#processingInvoice").removeClass("hidden"),t.submitButton.addClass("green effect fill-horizontal"),t.submitButton.removeAttr("disabled");var r=$("#requestId").val();if(void 0==r||"undefined"==r)var o=!0;else if(""==r)o=!0;else o=!1;if(a){var n=t.apiURL+"p2p.json";t.apiURL}else{if(o)n=t.apiURL+"genbill.json";else n=t.apiURL+"genUploadRRR.json";t.apiURL,t.apiURL}var i={},s=$("#CustomForm").serializeArray(),l=[],d=($("#howDoYouWantToPay").val(),$("#selectCurrency").find(":selected").data("code"));if(a){var c=$("#whoDoYouWantToPayFF").val(),m=$("#getBenMFB").attr("data-mfbcode"),u=$("#benAccountNumber").val(),p=$("#benEmail").val(),v=$("#benPhone").val(),y=$("#desc").val();E=parseFloat($("#subTotalSpan").text().replace(/,/g,"")),D=$("#payersFullName").val(),b=$("#payersEmail").val(),S=$("#payersPhone").val(),I={amount:E,benAccNo:u,benBankCode:m,benName:c,benEmail:p,benPhoneNumber:v,description:y,curCode:d,payerName:D,payerEmail:b,payerPhone:S}}else{var h=$("#whoDoYouWantToPay").val()?$("#whoDoYouWantToPay").val():$("#whoDoYouWantToPayFF").val(),f=$("#whoDoYouWantToPayId").val(),C=$("#nameOfServiceOrPurpose").val();!C&&pageSettings.serviceDetailId&&(C=pageSettings.serviceDetailId);var g=$("#theAmountIWantToPay").val();if(""!=g&&"undefined"!=g&&void 0!=g){var E=g;$("#partPayment").removeClass("hidden"),$("#partPayment .partPayment").text(remitaUiCtrl.formatCurrency(E))}else if("true"==t.isSpecificBiller)var E=parseFloat($("#subTotalSpan").text().replace(/,/g,""));else E=parseFloat($("#subTotalSpan").text().replace(/,/g,""));var D=$("#payersFullName").val();if(remitaUiCtrl.settings.allowEmail&&"Y"===remitaUiCtrl.settings.allowEmail.allowNoEmail)var b=$("#payersEmail").val()||remitaUiCtrl.settings.allowEmail.defaultEmail;else var b=$("#payersEmail").val();var S=$("#payersPhone").val(),I=($("#theAmountIWantToPay").val(),{billerName:h,billerId:f,billId:C,amount:E,payerName:D,payerEmail:b,payerPhone:S})}$.each(s,function(e,t){"SL"!==t.name.split("_")[1]&&"sp-item[]"!==t.name&&"sp-item-price"!==t.name&&"sp-item"!=t.name&&(t.name.split("_")[1],"AC"==t.name.split("_")[1]&&(document.getElementsByName(t.name),t.value=document.getElementsByName(t.name)[0].getAttribute("data-selected")),l.push({name:t.name.split("_")[0],value:t.value,type:t.name.split("_")[1]}))}),$.each($(".sl-items"),function(e,t){var a=$(t).attr("name").split("_")[0];try{l.push({name:a,value:$(t).val().toString(),type:"SL"})}catch(e){$(".multiselect .dropdown-toggle .btn .btn-default").addClass("form-error"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.select.one.item.from.the.select.list"])}});var U=[],T="";$.each($(".sp-items-table"),function(e,t){$(t).find(".sp-items").each(function(e,t){$(t).is(":checked")&&(T=$(t).data("columnname"),U.push({unitPrice:$(t).attr("price")?$(t).attr("price"):$("#"+$(t).attr("id")+"-up").val(),fixedPrice:$(t).attr("fixedprice"),quantity:$("#"+$(t).attr("id")+"-qty").val(),code:$(t).data("code"),itemName:$(t).data("description")?$(t).data("description"):$(t).data("code"),selectedListId:$(t).attr("id"),selected:$(t).is(":checked")}))}),U.length>0&&l.push({name:T,value:JSON.stringify(U),type:"SP"})}),i.data=I,a||(o?i.custom=l:(i.custom=l,i.requestId=r)),i.transactionType="PAYMENT",i.currency=d,i.rrrGenChannel="WEB";var P=t.merchantRedirectUrl?t.merchantRedirectUrl:t.returnPath+"/onepage/pred.spa";i.merchantRedirectUrl=P;i.data.amount=parseFloat(t.amount.val().replace(/,/g,"")),servicesCtrl.generatePaymentRRR(n,i).then(function(e){var t=servicesCtrl.remitaDecode(e);if("00"===t.responseCode&&!1===$.isEmptyObject(t.responseData[0])){var a=maskCtrl.getUnformattedValue(t.responseData[0].rrrNumber),r=t.responseData[0].descriptionOfPayment||a+" - NARRATION",o={amount:i.data.amount,rrr:a},n=$("#payersFullName").val().split(/\s+/);"ONLINE"===$("#paymentOption").val()?servicesCtrl.logPayment(o).then(function(e){var t=servicesCtrl.remitaDecode(e).responseData[0].cardOrderId;payOnceCtrl.generatedPayload={email:b,customerId:b,transactionId:t,narration:r,firstName:n[0],lastName:n[n.length-1],amount:i.data.amount,onSuccess:payOnceCtrl.makePaymentOnSuccessCallbackFn,onError:payOnceCtrl.makePaymentOnErrorCallbackFn,onClose:payOnceCtrl.makePaymentOnCloseFn,currency:i.currency,processRrr:!0,rrrNumber:a},remitaInline.makePayment(payOnceCtrl.generatedPayload)},function(){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]),$("#processingInvoice").addClass("hidden")}):remitaUiCtrl.generateReceiptWithRrr(a,!1)}else remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]),$("#processingInvoice").addClass("hidden")},function(){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"]),$("#processingInvoice").addClass("hidden")})}},function(e){remitaUiCtrl.captchaErrorMsg(t),grecaptcha.reset(widgetId2),grecaptcha.reset(widgetId1)}));else if(a){c=$("#mainForm").validate(),m=$("#paymentDetails").validate();$("#showServiceCharge").addClass("hidden"),$("#instruction").removeClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.complete.mandtory.field"]),$("#error-div-instructionMsg").append("<ol>");for(u=0;u<c.errorList.length;u++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+c.errorList[u].element.dataset.errlabel+"</span></li>");for(u=0;u<m.errorList.length;u++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+m.errorList[u].element.dataset.errlabel+"</span></li>");$("#error-div-instructionMsg").append("</ol>")}else{var d=$("#CustomForm").validate(),c=$("#mainForm").validate(),m=$("#paymentDetails").validate();i=$("#myForm").validate();$("#showServiceCharge").addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.complete.mandtory.field"]),$("#error-div-instructionMsg").append("<ol>");for(var u=0;u<d.errorList.length;u++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+d.errorList[u].element.dataset.errlabel+"</span></li>");for(var u=0;u<c.errorList.length;u++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+c.errorList[u].element.dataset.errlabel+"</span></li>");for(var u=0;u<m.errorList.length;u++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+m.errorList[u].element.dataset.errlabel+"</span></li>");$("#error-div-instructionMsg").append("</ol>")}}}),remitaUiCtrl.getCardLov(t),t.docReady.on("change","#selectBank",function(){$("#selectBank").val();$("#selectBankBranch").removeAttr("disabled")}),t.docReady.on("change","#numType",function(){$("#dateType").val("0000-00-00"),document.getElementById("dateType").setAttribute("readonly","readonly")}),t.docReady.on("change","#dateType",function(){$("#numType").val(" "),document.getElementById("numType").setAttribute("readonly","readonly")}),t.docReady.on("click","#dateType",function(){document.getElementById("dateType").removeAttribute("readonly")}),t.docReady.on("click","#numType",function(){document.getElementById("numType").removeAttribute("readonly")}),t.docReady.on("change","#howDoYouWantToPay",function(){if(remitaUiCtrl.getHowDoYouWantToPayDb(t),"CARD"!=$("#howDoYouWantToPay").val()){$("#howDoYouWantToPay").removeClass("form-error");var e=$("#itemTotal").val(),a=$("#payersEmail").val(),r=$("#howDoYouWantToPay").val(),o=$("#selectCurrency").find(":selected").data("code"),n=$("#card_number").val(),i=t.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(i,e,o,r,n,"","",a,t)}}),t.docReady.on("change","#transType",function(){"Recurring payment"==$("#transType").val()?($("#recurringPaymentForm").removeClass("hidden"),$("#payOnceForm").addClass("hidden")):"Pay once"==$("#transType").val()&&($("#recurringPaymentForm").addClass("hidden"),$("#payOnceForm").removeClass("hidden"))}),t.docReady.on("click","#refreshCaptcha",function(){remitaUiCtrl.getCaptchaImage("PayOnce","img","captchaInput","captchaError")})},generatePaymentRRRErrorHandler:function(e){},makePaymentOnSuccessCallbackFn:function(e){$("#processingInvoice").removeClass("hidden");var t=payOnceCtrl.generatedPayload.rrrNumber;servicesCtrl.setLocalData("ib"+t,"null"),servicesCtrl.setLocalData("rrr"+t,{responseCode:"00",responseMsg:"successful"}),remitaUiCtrl.generateReceiptWithRrr(t,!1)},makePaymentOnErrorCallbackFn:function(){$("#processingInvoice").addClass("hidden")},makePaymentOnCloseFn:function(){$("#processingInvoice").addClass("hidden")}};$(function(){payOnceCtrl.init(pageSettings)});var standingOrderCtrlActivated=!1;function isNotMandate(e){return"SO"!==e&&"DD"!==e}var standinOrderCtrl={validationPayload:{},settings:{whoDoYouWantToPay:$("#whoDoYouWantToPayStandinOrder"),whoDoYouWantToPayId:$("#whoDoYouWantToPayIdStandinOrder"),itemTotal:$("#itemTotalStandinOrder"),serviceChargeSpan:$("#serviceCharge .serviceChargeStandinOrder"),totalAmountToBePaySpan:$("#totalAmoutToPayStandinOrder .totalAmoutToPayStandinOrder"),output:$("#outputStandinOrder"),nameOfServiceOrPurpose:$("#nameOfServiceOrPurposeStandinOrder"),selectCurrency:$("#selectCurrencyStandinOrder"),customFields:$("#customFieldsStandinOrder"),showHowDoYouWantToPayCustomFields:$("#showHowDoYouWantToPayCustomFields"),showPayerInstitutionStandinOrder:$("#showPayerInstitutionStandinOrder"),billerName:$("#billerNameStandinOrder"),billerLogo:$("#billerLogoStandinOrder"),payerAccountNumber:$("#payerAccountNumber"),showServiceCharge:$("#showServiceChargeStandinOrder"),getMFB:$("#getMFB"),totalAmoutToPay2EndPoint:$("#totalAmoutToPay2StandinOrder"),serviceCharge:$("#serviceChargeStandinOrder"),totalAmoutToPay:$("#totalAmoutToPayStandinOrder"),setCurrencySign:$(".setCurrencySign"),subTotal:$("#subTotalSpanStandinOrder"),instruction:$("#instruction"),captchaInput:$("#captchaInputStandinOrder"),captchaError:$(".captchaError"),submitButton:$("#submitStandinOrder"),mainForm:$("#mainFormStandinOrder"),CustomForm:$("#CustomFormStandinOrder"),paymentDetails:$("#paymentDetailsStandinOrder"),totalPotential:$("#total_potential_StandinOrder"),selectedBillerId:null,email:$("#payersEmailStandinOrder"),email_confirm:$("#payersEmailStandinOrder_confirm"),req:null,docReady:$(document),reqSpan:null,sumItemPrice:null,itemPrice:null,ischecked:!1,serviceTypeId:null,columnType:null,validateQRInterval:null},init:function(e){this.settings=$.extend(standinOrderCtrl.settings,e);var t=standinOrderCtrl.settings;if("true"==servicesCtrl.settings.isSpecificBiller)var a=servicesCtrl.settings.billerCode;else a="billers";servicesCtrl.getLocalData("banklov");servicesCtrl.getDataEndPointData(t.billerUrl,a).then(function(){remitaUiCtrl.loadBillersAutoComplete(t)},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}),servicesCtrl.getDataEndPointData(t.banklovUrl,"banklov").then(function(){remitaUiCtrl.loadFnFBankLov("#getBenMFBStandinOrder")},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}),servicesCtrl.getDataEndPointData("banklist/bank.json","otpBankLov").then(function(){remitaUiCtrl.loadOtpBankForMandate("#getMFB",t),remitaUiCtrl.loadOtpBankForMandate("#getMFBPayer",t)},function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}),remitaUiCtrl.loadOtpBankForMandate("#getMFBPayer",t),remitaUiCtrl.getSPItemsOnBlur(t,"total_potential_StandinOrder"),remitaUiCtrl.setNairaAsDefualt(t),remitaUiCtrl.getSLItemsOnBlur(t),t.docReady.on("change","#itemTotalStandinOrder",function(){}),t.docReady.on("click","#skip-to-form",function(){remitaUiCtrl.generateReceiptWithRrr(standinOrderCtrl.validationPayload.rrr,!1)}),t.docReady.on("change","#selectCurrencyStandinOrder",function(){remitaUiCtrl.loadCurrencySign(t)}),$(document).on("blur","#bankAccount",function(e){var a=$("#itemTotalStandinOrder").val(),r=$("#payersEmailStandinOrder").val(),o=$("#selectCurrencyStandinOrder").find(":selected").data("code"),n=$("#bankId").val(),i=t.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(i,a,o,"Instant","Instant","",n,r,t)}),$(document).on("blur","#card_number",function(e){var a=$("#itemTotalStandinOrder").val(),r=$("#payersEmailStandinOrder").val(),o=$("#selectCurrencyStandinOrder").find(":selected").data("code"),n=$("#card_number").val(),i=t.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(i,a,o,"Instant",n,"","",r,t)}),t.docReady.on("change","#payerInstitutionStandinOrder",function(){t.payerAccountNumber.val("")}),t.docReady.on("change","#selectCurrencyStandinOrder",function(){remitaUiCtrl.loadCurrencySign(t)}),t.docReady.on("blur","#captchaInputStandinOrder",function(){var e=JSON.parse(sessionStorage.cridValue).crid,a=remitaUiCtrl.removeCaptchaInputSpace(t.captchaInput.val());remitaUiCtrl.checkCaptchaAnswerOnBlur(a,e,t)}),t.docReady.on("click","#formResetStandinOrder",function(){remitaUiCtrl.resetForms(t),$("#customFieldsStandinOrder").addClass("hidden")}),t.docReady.on("click","#submitStandinOrder",function(e){var t=$("#fundingSource").val();e.preventDefault();var a=standinOrderCtrl.settings,r=$("#FNF").data("fnf");if(r)var o=$("#mainFormStandinOrder").valid(),n=$("#paymentDetailsStandinOrder").valid();else{o=$("#mainFormStandinOrder").valid();var i=$("#CustomFormStandinOrder").valid();n=$("#paymentDetailsStandinOrder").valid()}$("#getMFBPayer").attr("data-mfbcode")?$("#getMFBPayer").attr("data-mfbcode"):$("#getMFB").attr("data-mfbcode");if(0==remitaUiCtrl.checkEmailConfirmation(a))remitaUiCtrl.showFormErrors("Please confirm your email address");else if(""==$("#itemTotalStandinOrder").val()||"0.00"==$("#itemTotalStandinOrder").val())remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.complete.mandtory.field"]);else if("CARD"!==t||standinOrderCtrl.validateEmdDateWithCardExpirationDate()){if(r)var s=o&&n;else s=o&&i&&n;if(s){if(!remitaUiCtrl.checkForEmptyInput()){$("#processingInvoiceStandinOrder").removeClass("hidden");$("#payerAccountNumber").val()?$("#payerAccountNumber").val():$("#bankAccount").val();remitaCaptcha.checkCaptchaAnswer(grecaptcha.getResponse(widgetId2)).then(function(e){if(e){if(a.submitButton.addClass("green effect fill-horizontal"),a.submitButton.removeAttr("disabled"),r)var o=a.apiURL+"card/mt/rrr/generate.json?_thru",n=a.apiURL+"genftso.json";else o=a.apiURL+"card/bill/rrr/generate.json?_thru",n=a.apiURL+"genbillso.json";var i={activationType:t};"CARD"===t&&(i.cvv=$("#cvc").val(),i.pan=$("#card_number").val().replace(/\s/g,""),i.expiringDate=$("#expiringDate").val(),i.channel="CARD");var s=$("#CustomFormStandinOrder").serializeArray(),l=[];if(r)var d=$("#whoDoYouWantToPayStandinOrderFF").val(),c=$("#getBenMFBStandinOrder").attr("data-mfbcode"),m=$("#benAccountNumberStandinOrder").val(),u=$("#benEmailStandinOrder").val(),p=$("#benPhoneStandinOrder").val(),v=$("#descStandinOrder").val(),y=$("#whoDoYouWantToPayIdStandinOrder").val(),h=parseFloat($("#subTotalSpan").text().replace(/,/g,"")),f=$("#payersFullNameStandinOrder").val(),C=$("#payersEmailStandinOrder").val(),g=$("#payersPhoneStandinOrder").val(),E=$("#nameOfServiceOrPurposeStandinOrder option:selected").text(),D=D,b=$("#getMFBPayer").attr("data-mfbcode")?$("#getMFBPayer").attr("data-mfbcode"):$("#bankId").val(),S=$("#getMFBPayer"),I={amount:h,payerName:f,payerPhone:g,benAccNo:m,benBankCode:c,benName:d,payerAccNo:($("#payerAccountNumber").val()?$("#payerAccountNumber").val():$("#bankAccount").val())||"",payerBankCode:b||"",description:v,benPhoneNumber:p,benEmail:u,payerEmail:C};else{var U=$("#whoDoYouWantToPayStandinOrder").val(),T=(y=$("#whoDoYouWantToPayIdStandinOrder").val(),$("#nameOfServiceOrPurposeStandinOrder").val());h=parseFloat($("#subTotalSpan").text().replace(/,/g,"")),f=$("#payersFullNameStandinOrder").val();if(remitaUiCtrl.settings.allowEmail&&"Y"===remitaUiCtrl.settings.allowEmail.allowNoEmail)C=$("#payersEmailStandinOrder").val()||remitaUiCtrl.settings.allowEmail.defaultEmail;else C=$("#payersEmailStandinOrder").val();g=$("#payersPhoneStandinOrder").val(),E=$("#nameOfServiceOrPurposeStandinOrder option:selected").text();var P=$("#selectCurrencyStandinOrder option:selected").data("code");D=$("#payerAccountNumber").val()?$("#payerAccountNumber").val():$("#bankAccount").val(),b=$("#getMFB").attr("data-mfbcode")?$("#getMFB").attr("data-mfbcode"):$("#bankId").val(),S=$("#getMFB"),I={amount:h,billId:T,billerId:y,billerName:U,payerAccNo:D||"",payerBankCode:b||"",payerEmail:C,payerName:f,payerPhone:g,serviceTypeName:E,currencyCode:P}}var F=$("#recurringPaymentType").val();if("SO"==F){var w=$("#endDateType").val(),O=$("#everyStandinOrder").val(),N=$("#startDateStandinOrder").val(),x=$("#endNumType").val()?$("#endNumType").val():0,A=0;w=(w=w.split("-"))[1]+"/"+w[0]+"/"+w[2];var k=new Date(w).getTime();N=(N=N.split("-"))[1]+"/"+N[0]+"/"+N[2];var B=new Date(N).getTime()}else if("DD"==F){var L=$("#startDateStandinOrderDD").val(),R=$("#endDateTypeDD").val();O=null,x=0,A=$("#maxUploadNo").val();R=(R=R.split("-"))[1]+"/"+R[0]+"/"+R[2];k=new Date(R).getTime();L=(L=L.split("-"))[1]+"/"+L[0]+"/"+L[2];B=new Date(L).getTime()}var M={endDate:k,frequency:O,maxUploadLimit:A,numberOfTimes:x,startDate:B,transType:F};$.each(s,function(e,t){"SL"!==t.name.split("_")[1]&&"sp-item[]"!==t.name&&"sp-item-price"!==t.name&&"sp-item"!=t.name&&("AC"==t.name.split("_")[1]&&(document.getElementsByName(t.name),t.value=document.getElementsByName(t.name)[0].getAttribute("data-selected")),l.push({name:t.name.split("_")[0],value:t.value,type:t.name.split("_")[1]}))}),$.each($(".sl-items"),function(e,t){var a=$(t).attr("id");try{l.push({name:a,value:$(t).val().toString(),type:"SL"})}catch(e){$(".multiselect .dropdown-toggle .btn .btn-default").addClass("form-error"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.select.one.item"])}});var Y=[],_="";$.each($(".sp-items-table"),function(e,t){$(t).find(".sp-items").each(function(e,t){$(t).is(":checked")&&(_=$(t).data("columnname"),Y.push({unitPrice:$(t).attr("price")?$(t).attr("price"):$("#"+$(t).attr("id")+"-up").val(),fixedPrice:$(t).attr("fixedprice"),quantity:$("#"+$(t).attr("id")+"-qty").val(),code:$(t).data("code"),itemName:$(t).data("description")?$(t).data("description"):$(t).data("code"),selectedListId:$(t).attr("id"),selected:$(t).is(":checked")}))}),Y.length>0&&l.push({name:_,value:JSON.stringify(Y),type:"SP"})}),i.data=I,r?(i.recurring=M,i.transactionType="SO",i.rrrGenChannel="WEB"):(i.custom=l,i.recurring=M,i.transactionType="PAYMENT",i.transactionType="SO",i.rrrGenChannel="WEB",i.companyId=y,i.compId=y);var W=a.merchantRedirectUrl?a.merchantRedirectUrl:a.returnPath+"/onepage/pred.spa";i.merchantRedirectUrl=W;var j=W,G=servicesCtrl.remitaEncode(JSON.stringify(i));standinOrderCtrl.settings.formObjPayload=i,$.ajax({url:n,type:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},dataType:"text",data:G,success:function(e){remitaUiCtrl.hideFormErrors();var a=servicesCtrl.remitaDecode(e);if("00"==a.responseCode){var r=maskCtrl.getUnformattedValue(a.responseData[0].rrrNumber),n=$(".optbankcall").data("mfbcode"),s=($("#bankAccount").val(),S.attr("data-otpenabled")),l=S.attr("data-regauthtype"),d=a.responseData[0].paymentType,c=a.responseData[0];if(standinOrderCtrl.validationPayload.rrr=c.rrrNumber,standinOrderCtrl.validationPayload.activationType=c.activationType,standinOrderCtrl.validationPayload.authorizationType=c.activationType,isNotMandate(d)&&"SELF_BANK"==l&&("true"==s||s)){var m={rrrNumber:r,bankCode:n||"",bankAccount:D||"",cardType:"ACCOUNT",mandate:"true",merchantRedirectUrl:j};$("#modal-su").on("shown.bs.modal",function(e){$(this);var t=servicesCtrl.remitaEncode(JSON.stringify(i)),a=servicesCtrl.remitaEncode(JSON.stringify(m)),r={url:o,params:{payload:t,paymentDetails:a}};Forms.postRedirect(r)}),$("#modal-su").modal({backdrop:"static",keyboard:!1})}else if(t.match(/ACCOUNT/i))if("SELF_BANK"===l){var u=standinOrderCtrl.buildOtpRequestPayload(i);$.ajax({url:"/remita/onepage/activate-mandate.json",type:"POST",contentType:"application/json; charset=utf-8",dataType:"text",data:JSON.stringify(u),success:function(e){$("#otpForm").removeClass("hidden"),$(".qr-code-section").addClass("hidden"),standinOrderCtrl.handleSuccessfulOtpRequest(e)},error:function(e){remitaUiCtrl.showFormErrors('<p>Something went wrong activating mandate. <a href="#" id="skip-to-form">CLICK HERE</a> to print form for manual bank processing</p>')}})}else remitaUiCtrl.generateReceiptWithRrr(r,!1);else{var p=servicesCtrl.remitaDecode(e).responseData[0],v=i.data.payerName.split(" "),y="card"===t.toLowerCase()?"card":"bank",h={amount:p.activationAmount,rrr:p.activationRef,channel:y};$.ajax({url:"/remita/onepage/cloud/send/api/posttasksvc/profile/paymentlog.json",type:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},dataType:"text",data:servicesCtrl.remitaEncode(JSON.stringify(h))}).then(function(e){var a=servicesCtrl.remitaDecode(e).responseData[0].cardOrderId;standinOrderCtrl.generatedPayload={amount:p.activationAmount,customerId:i.data.payerEmail,channel:t,email:i.data.payerEmail,onSuccess:standinOrderCtrl.makePaymentOnSuccessCallbackFn,onError:standinOrderCtrl.makePaymentOnErrorCallbackFn,onClose:standinOrderCtrl.makePaymentOnCloseFn,narration:p.activationNaration,rrrNumber:p.rrrNumber,transactionId:a,currency:i.data.currencyCode,firstName:v[0],lastName:v[v.length-1],tokenize:!0,activationType:t,activationRef:p.activationRef};var r=i.expiringDate.split("/");standinOrderCtrl.generatedPayload.cvv=i.cvv,standinOrderCtrl.generatedPayload.pan=i.pan,standinOrderCtrl.generatedPayload.expiryMonth=r[0],standinOrderCtrl.generatedPayload.expiryYear=r[1],standinOrderCtrl.makePayment(standinOrderCtrl.generatedPayload)})}}else $("#processingInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},error:function(e){$("#processingInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}})}},function(e){remitaUiCtrl.captchaErrorMsg(a),grecaptcha.reset(widgetId2),grecaptcha.reset(widgetId1)})}}else if(r){var l=$("#mainFormStandinOrder").validate(),d=$("#paymentDetailsStandinOrder").validate();$("#showServiceChargeStandinOrder").addClass("hidden"),$("#instruction").removeClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.complete.mandtory.field"]),$("#error-div-instructionMsg").append("<ol>");for(var c=0;c<l.errorList.length;c++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+l.errorList[c].element.dataset.errlabel+"</span></li>");for(c=0;c<d.errorList.length;c++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+d.errorList[c].element.dataset.errlabel+"</span></li>");$("#error-div-instructionMsg").append("</ol>")}else{l=$("#mainFormStandinOrder").validate();var m=$("#CustomFormStandinOrder").validate();d=$("#paymentDetailsStandinOrder").validate();$("#showServiceChargeStandinOrder").addClass("hidden"),$("#instruction").removeClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.please.complete.mandtory.field"]),$("#error-div-instructionMsg").append("<ol>");for(c=0;c<l.errorList.length;c++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+l.errorList[c].element.dataset.errlabel+"</span></li>");for(c=0;c<m.errorList.length;c++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+m.errorList[c].element.dataset.errlabel+"</span></li>");for(c=0;c<d.errorList.length;c++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+d.errorList[c].element.dataset.errlabel+"</span></li>");$("#error-div-instructionMsg").append("</ol>")}}else remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE.getKey("core.credit.card.expiry.date.expires.before.mandate.end.date"))}),t.docReady.on("change","#selectBank",function(){$("#selectBank").val();$("#selectBankBranch").removeAttr("disabled")}),t.docReady.on("blur","#itemTotalStandinOrder",function(){if($("#FNF").data("fnf")){if(""!=$("#getMFBPayer").val()){var e=$("#itemTotalStandinOrder").val(),a=$("#payersEmailStandinOrder").val(),r=$("#whoDoYouWantToPayStandinOrderFF").val(),o=$("#selectCurrencyStandinOrder").find(":selected").data("code"),n=$("#card_number").val(),i="",s="",l=t.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(l,e,o,r,n,i,s,a,t)}}else if(""!=$("#getMFB").val()){$("#whoDoYouWantToPayStandinOrder").removeClass("form-error");e=$("#itemTotalStandinOrder").val(),a=$("#payersEmailStandinOrder").val(),r=$("#whoDoYouWantToPayStandinOrder").val(),o=$("#selectCurrencyStandinOrder").find(":selected").data("code"),n=$("#card_number").val(),i="",s="",l=t.nameOfServiceOrPurpose.val();remitaUiCtrl.getServiceChargeNew(l,e,o,r,n,i,s,a,t)}}),t.docReady.on("change","#endNumType",function(){}),t.docReady.on("change","#endDateType",function(){document.getElementById("endNumType").value="",document.getElementById("endNumType").setAttribute("readonly","readonly")}),t.docReady.on("click","#endDateType",function(){}),t.docReady.on("click","#endNumType",function(){document.getElementById("endNumType").removeAttribute("readonly")}),t.docReady.on("change","#payerInstitutionStandinOrder",function(){$("#payerInstitutionStandinOrder").removeClass("ui-autocomplete-loading");var e=$("#payerInstitutionStandinOrder").val();$("#showPayerInstitutionStandinOrder").html(""),$("#showPayerInstitutionStandinOrder").html(standinOrderCtrl.buildCommercialBankListSelect(e))}),t.docReady.on("click","#refreshCaptchaStandinOrder",function(){remitaUiCtrl.getCaptchaImage("StandinOrder","imgStandinOrder","captchaInputStandinOrder","captchaErrorStandinOrder")}),t.docReady.on("change","#nameOfServiceOrPurposeStandinOrder",function(){remitaUiCtrl.getServiceTypeOnchange(t,"total_potential_StandinOrder","")}),t.docReady.on("click",".request-opt-for-buy-on-credit",function(e){clearInterval(standinOrderCtrl.settings.validateQRInterval),$.ajax({url:"/remita/onepage/activate-mandate.json",type:"POST",contentType:"application/json; charset=utf-8",dataType:"text",data:JSON.stringify(standinOrderCtrl.buildOtpRequestPayload(standinOrderCtrl.settings.formObjPayload)),success:function(e){$(".qr-code-section").addClass("hidden"),$("#otpForm").removeClass("hidden"),standinOrderCtrl.handleSuccessfulOtpRequest(e)},error:function(e){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}})}),t.docReady.on("click",".btn-supply-otp",function(e){e.preventDefault();var t={};$("[name*=userAuthCode]").each(function(e,a){t[$(a).prop("name")]=$(a).val(),$(a).hasClass("expirydate")&&(t[$(a).prop("name")]=$(a).val().replace("/",""))});var a=Object.assign(standinOrderCtrl.validationPayload,t);standinOrderCtrl.validateBankOtp(a)})},activate:function(){standingOrderCtrlActivated||(standinOrderCtrl.init(pageSettings),standingOrderCtrlActivated=!0)},buildOtpRequestPayload:function(e){return standinOrderCtrl.validationPayload.accountNumber=e.data.payerAccNo,standinOrderCtrl.validationPayload.bankCode=e.data.payerBankCode,{accountNumber:e.data.payerAccNo,bankCode:e.data.payerBankCode}},handleSuccessfulOtpRequest:function(e){var t=JSON.parse(e).responseData[0],a=t.requiredAuthTypes;standinOrderCtrl.validationPayload.requestId=t.requestId,standinOrderCtrl.validationPayload.transRef=t.requestId,$("[data-bank-custom-fields]").data("bank-custom-fields",a),$(document).trigger("custom-fields-loaded"),$("#otp-modal").modal("show"),$("#otp-modal").appendTo("body")},validateBankOtp:function(e){$.ajax({url:"/remita/onepage/validate-otp.json",type:"POST",dataType:"text",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(e){var t=JSON.parse(e);"00"===t.responseCode&&t.responseData[0].status.match(/ACTIVATED/i)?($("#otp-modal").modal("hide"),servicesCtrl.setLocalData("ib"+standinOrderCtrl.validationPayload.rrr,"null"),servicesCtrl.setLocalData("rrr"+standinOrderCtrl.validationPayload.rrr,{responseCode:"00",responseMsg:"successful"}),remitaUiCtrl.generateReceiptWithRrr(standinOrderCtrl.validationPayload.rrr,!1)):($("#otp-modal").modal("hide"),remitaUiCtrl.showFormErrors("Error Activating RRR"))},error:function(e){$("#otp-modal").modal("hide"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}})},validateEmdDateWithCardExpirationDate:function(){var e=!1,t=$('[id^="endDateType"]').filter(":visible").val().split("-"),a=+t[1],r=+t[2].substr(2,2),o=$("#expiringDate").val().split("/"),n=+o[0],i=+o[1];return i<r||i===r&&n<=a||(remitaUiCtrl.hideFormErrors(),e=!0),e},generatePaymentRRRErrorHandler:function(e){},generatePaymentRRR:function(e,t){var a=servicesCtrl.remitaEncode(JSON.stringify(t));return $.ajax({url:e,type:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},dataType:"text",data:a})},makePaymentOnSuccessCallbackFn:function(e){$("#processingInvoice").removeClass("hidden");var t=standinOrderCtrl.generatedPayload.rrrNumber;servicesCtrl.setLocalData("ib"+t,"null"),servicesCtrl.setLocalData("rrr"+t,{responseCode:"00",responseMsg:"successful"});var a={rrr:t,authRequestType:"MANDATE",requestChannel:"WEB",authorizationType:"CARD",activationRef:standinOrderCtrl.generatedPayload.activationRef};$.ajax({url:"/remita/onepage/cloud/web/authorizepayment.json",method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},data:servicesCtrl.remitaEncode(JSON.stringify(a))}).then(function(e){var a=servicesCtrl.remitaDecode(e);a&&"00"===a.responseCode&&"ACTIVATED"===a.responseData[0].status?remitaUiCtrl.generateReceiptWithRrr(t,!1):remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},function(e){})},makePaymentOnErrorCallbackFn:function(){$("#processingInvoiceStandinOrder").addClass("hidden")},makePaymentOnCloseFn:function(){$("#processingInvoiceStandinOrder").addClass("hidden")},makePayment:function(e){e.amount&&e.pan&&e.expiryMonth&&e.expiryYear&&e.cvv&&RmPaymentEngine.init({key:pageSettings.REMITA_PAY_INLINE_PUBLIC_KEY,transactionId:e.transactionId,customerId:e.email,firstName:e.firstName,lastName:e.lastName,email:e.email,channel:e.channel,amount:e.amount,currency:e.currency,narration:e.narration,pan:e.pan,expiryMonth:e.expiryMonth,expiryYear:e.expiryYear,cvv:e.cvv,onSuccess:e.onSuccess,onError:e.onError,onClose:e.onClose,config:{host:pageSettings.host}}).openIframe()}},eInviceCtrlActivated=!1,eInvoiceCtrl={settings:{whoDoYouWantToPayEInvoice:$("#whoDoYouWantToPayEInvoice"),whoDoYouWantToPayIdEInvoice:$("#whoDoYouWantToPayIdEInvoice"),howDoYouWantToPayDiv:$("#howDoYouWantToPayDivEInvoice"),howDoYouWantToPay:$("#howDoYouWantToPayEInvoice"),payerDetailsEInvoice:$("#payerDetailsEInvoice"),billerLogo:$("#billerLogoEInvoice"),selectCurrency:$("#selectCurrency"),showHowDoYouWantToPayCustomFields:$("#showhowDoYouWantToPayEInvoiceCustomFields"),billerLogoDivEInvoice:$("#billerLogoDivEInvoice"),billerNameEInvoice:$("#billerNameEInvoice"),confirmRecieverEInvoice:$("#confirmRecieverEInvoice"),docReady:$(document),selectedBillerIdEInvoice:null,submitButton:$("#submitStandinOrder"),mainForm:$("#mainFormEInvoice"),CustomForm:$("#CustomFormEInvoice"),paymentDetails:$("#paymentDetailsEInvoice"),isEInvoice:!0,serviceCharge:$("#serviceCharge"),showServiceCharge:$("#showServiceCharge"),serviceChargeSpan:$("#serviceCharge .serviceCharge"),setCurrencySign:$(".setCurrencySign"),email:$("#payersEmailEInvoice"),currenySymbol:null,currency:null,paymentLogData:{}},init:function(e){this.settings=$.extend(eInvoiceCtrl.settings,e);var t=eInvoiceCtrl.settings;t.docReady.on("click","#formResetEInvoice",function(){remitaUiCtrl.hideFormErrors(),t.confirmRecieverEInvoice.html(""),t.confirmRecieverEInvoice.addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),$("#showhowDoYouWantToPayEInvoiceCustomFields").addClass("hidden"),$("#mainFormEInvoice").trigger("reset"),$("#CustomFormEInvoice").trigger("reset"),$("#paymentDetailsEInvoice").trigger("reset"),t.billerNameEInvoice.html(""),t.billerLogoDivEInvoice.addClass("hidden"),t.howDoYouWantToPayDiv.addClass("hidden")}),t.docReady.on("click","#formResetEInvoice3",function(){$("#showhowDoYouWantToPayEInvoiceCustomFields").addClass("hidden"),$(".float-left-div").addClass("hidden"),$("#billerNameEInvoice").addClass("hidden"),$("#billerLogoEInvoice").addClass("hidden"),t.billerNameEInvoice.html(""),t.billerLogoDivEInvoice.addClass("hidden"),t.confirmRecieverEInvoice.html(""),t.howDoYouWantToPayDiv.addClass("hidden"),t.confirmRecieverEInvoice.addClass("hidden"),remitaUiCtrl.resetForms(t)}),t.docReady.on("change","#selectCurrencyEInvoice",function(){remitaUiCtrl.loadCurrencySign(t)}),$(document).on("blur","#card_number",function(){1==$("#howDoYouWantToPayEInvoice").find(":selected").data("cancapture")&&eInvoiceCtrl.getServiceChargeForEInvoice()}),$("#RRRToPayEInvoice").on("keydown",function(e){13==e.which&&(e.preventDefault(),eInvoiceCtrl.validateRRRForPayment())}),$(document).on("blur","#theAmountIWantToPay",function(){var e=$("#amountToPay").val().replace(/,/gi,""),t=$("#theAmountIWantToPay").val().replace(/,/gi,"");if(e=Math.round(parseFloat(e)),(t=Math.round(parseFloat(t)))<=0||""==t)$("#amountToPay").val();else if(t>e){$("#theAmountIWantToPay").prop("value",e);$("#amountToPay").val()}else $("#theAmountIWantToPay").val();$("#payersEmailEInvoice").val(),$("#howDoYouWantToPayEInvoice").val(),$("#amountDueEInvoice").data("curCode"),$("#card_number").val(),$("#serviceTypeIdForEInvoice").val()}),t.docReady.on("click","#submitEInvoice",function(e){$("#formErrorEInvoice").addClass("hidden"),$("#formSucEInvoice").addClass("hidden"),e.preventDefault();var a=$("#RRRToPayEInvoice").val().replace(/-/gi,"");""==a?(t.billerNameEInvoice.html(""),t.billerLogoDivEInvoice.addClass("hidden"),t.confirmRecieverEInvoice.html(""),t.howDoYouWantToPayDiv.addClass("hidden"),t.confirmRecieverEInvoice.addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.enter.rrr"],0),$("#RRRToPayEInvoice").addClass("form-error")):$("#confirmRecieverEInvoice").is(":visible")&&void 0!=$("#amountToPay").val()&&void 0!=$("#theAmountIWantToPay").val()?$.ajax({url:t.apiURL+a+"/billsummaryfull.json",dataType:"text",success:function(e){remitaUiCtrl.hideFormErrors();var t=servicesCtrl.remitaDecode(e),a=t.responseData[0];if(eInvoiceCtrl.settings.paymentLogData.narration=t.responseData[0].descriptionOfPayment||a.rrrNumber+" - NARRATION","00"==t.responseCode)if("SO"==t.responseData[0].rrrType||"DD"==t.responseData[0].rrrType)$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'>"+MESSAGE_BUNDLE["core.this.mandate.rrr"]+"  </span>",0);else if("PENDING"==t.responseData[0].status)if($("#mainFormEInvoice").valid()){$("#processingInvoice").removeClass("hidden");var r=eInvoiceCtrl.settings,o=($("#whoDoYouWantToPayIdEInvoice").val(),$("#howDoYouWantToPayEInvoice").val(),$("#payersEmailEInvoice").val()),n=$("#payersPhoneEInvoice").val(),i=$("#payersFullNameEInvoice").val(),s=(t.responseData[0].currency,$("#RRRToPayEInvoice").val().replace(/-/gi,""));if("Y"==t.responseData[0].acceptPartPayment)var l=parseFloat($("#theAmountIWantToPay").val().replace(/,/g,""));else l=parseFloat($("#amountToPay").val().replace(/,/g,""));var d=r.merchantRedirectUrl?r.merchantRedirectUrl:r.returnPath+"/onepage/pred.spa",c=(r.apiURL,r.apiURL,r.apiURL,{rrr:s,payerName:i,payerEmail:o,payerPhone:n,merchantRedirectUrl:d}),m=(servicesCtrl.getLocalData("serviceCharges"),c.rrr);eInvoiceCtrl.settings.paymentLogData.amount=l,eInvoiceCtrl.settings.paymentLogData.rrr=m;var u=parseFloat(t.responseData[0].amountDue),p=t.responseData[0].payerName.split("");eInvoiceCtrl.handleGenBillAndPaymentLog(l,u,m).then(function(e){var a=servicesCtrl.remitaDecode(e).responseData[0].cardOrderId;eInvoiceCtrl.generatedPayload={email:c.payerEmail,amount:l,firstName:p[0],lastName:p[p.length-1],narration:eInvoiceCtrl.settings.paymentLogData.narration,transactionId:a,currency:t.responseData[0].currency,onSuccess:eInvoiceCtrl.makePaymentOnSuccessCallbackFn,onError:eInvoiceCtrl.makePaymentOnErrorCallbackFn,onClose:eInvoiceCtrl.makePaymentOnCloseFn,rrrNumber:eInvoiceCtrl.settings.paymentLogData.rrr},eInvoiceCtrl.generatedPayload.merchantRedirectUrl=d,remitaInline.makePayment(eInvoiceCtrl.generatedPayload)})}else{var v=$("#mainFormEInvoice").validate();remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.following.entry.not.valid"],0),$("#error-div-instructionMsg").append("<ol>");for(var y=0;y<v.errorList.length;y++)$("#error-div-instructionMsg").append("<li><span style='color:#de4b37 !important;'>"+v.errorList[y].element.dataset.errlabel+"</span></li>");$("#error-div-instructionMsg").append("</ol>")}else $("#hideServiceChargeDiv").addClass("hidden"),$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'> "+MESSAGE_BUNDLE["core.this.RRR.has.been.processed"]+" </span>");else{$("#hideServiceChargeDiv").addClass("hidden"),$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden");var h=t.responseMsg;remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'>"+h+"</span>")}},error:function(){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])}}):eInvoiceCtrl.validateRRRForPayment()}),t.docReady.on("change","#howDoYouWantToPayEInvoice",function(){if(remitaUiCtrl.getHowDoYouWantToPayDb(t),"CARD"!=$("#howDoYouWantToPayEInvoice").val())eInvoiceCtrl.getServiceChargeForEInvoice();else{var e=$("#showhowDoYouWantToPayEInvoiceCustomFields").find("#card_number");eInvoiceCtrl.validateCardDetails(e)}remitaUiCtrl.getCurrencySymbol(t.currenySymbol,t)}),remitaUiCtrl.getCardLov(t)},getServiceChargeForEInvoice:function(){var e=eInvoiceCtrl.settings;if($("#theAmountIWantToPay").val())t=$("#theAmountIWantToPay").val();else var t=$("#amountToPay").val();var a=$("#payersEmailEInvoice").val(),r=$("#howDoYouWantToPayEInvoice").val(),o=$("#amountDueEInvoice").data("curCode"),n=$("#card_number").val(),i=$("#serviceTypeIdForEInvoice").val();remitaUiCtrl.getServiceChargeNew(i,t,o,r,n,"","",a,e),$("#howDoYouWantToPayEInvoice").removeClass("form-error")},showFormErrors:function(e,t){1==t?($("#instructionTitle").html("Success"),$("#instruction").attr("style","background:#f2f2f2;")):($("#instructionTitle").html("Error(s)"),$("#instruction").attr("style","background:#fbd5d5;")),$("#instructionMsg").html(""),$("#instructionMsg").html(e)},activate:function(){eInviceCtrlActivated||(eInvoiceCtrl.init(pageSettings),eInviceCtrlActivated=!0)},validateRRRForPayment:function(){var e=eInvoiceCtrl.settings,t=$("#RRRToPayEInvoice").val().replace(/-/gi,"");""==t?(e.billerNameEInvoice.html(""),e.billerLogoDivEInvoice.addClass("hidden"),e.confirmRecieverEInvoice.html(""),e.howDoYouWantToPayDiv.addClass("hidden"),e.confirmRecieverEInvoice.addClass("hidden"),remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.enter.rrr"],0),$("#RRRToPayEInvoice").addClass("form-error")):($("#RRRToPayEInvoice").removeClass("form-error"),$("#theamountiwanttopayEDiv").addClass("hidden"),$(".float-left-div").removeClass("hidden"),$.ajax({url:e.apiURL+t+"/billsummaryfull.json",dataType:"text",success:function(t){var a=servicesCtrl.remitaDecode(t);if("00"==a.responseCode)if($("#howDoYouWantToPayEInvoice").removeClass("hidden"),$("#payerDetailsEInvoice").removeClass("hidden"),"SO"==a.responseData[0].rrrType||"DD"==a.responseData[0].rrrType)$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'> "+MESSAGE_BUNDLE["core.this.mandate.rrr"]+"  </span>",0);else if("PENDING"==a.responseData[0].status){$("#serviceTypeIdForEInvoice").val(a.responseData[0].serviceTypeId),"Y"==a.responseData[0].acceptPartPayment&&($("#theamountiwanttopayEDiv").removeClass("hidden"),$("#theAmountIWantToPay").prop("value",remitaUiCtrl.formatCurrency(a.responseData[0].amountDue))),remitaUiCtrl.hideFormErrors();var r=MESSAGE_BUNDLE["core.einvoice.successfully.processed"];e.billerLogoDivEInvoice.removeClass("hidden"),e.billerNameEInvoice.html('<h2  style="margin-bottom: 0px !important; padding-top: 10px !important; font-size: 18px">'+a.responseData[0].beneficiaryName+"</h2>"),e.confirmRecieverEInvoice.removeClass("hidden"),e.howDoYouWantToPayDiv.removeClass("hidden"),e.payerDetailsEInvoice.removeClass("hidden"),$("#payersEmailEInvoice").prop("value",a.responseData[0].payerEmail),$("#payersPhoneEInvoice").prop("value",a.responseData[0].payerMobile),$("#payersFullNameEInvoice").prop("value",a.responseData[0].payerName),e.currenySymbol=a.responseData[0].currenySymbol,e.currency=a.responseData[0].currency,remitaUiCtrl.store={currencyCode:a.responseData[0].currency},"Y"==a.responseData[0].acceptPartPayment?e.confirmRecieverEInvoice.html(MESSAGE_BUNDLE["core.amount.payable"]+' : <b style="margin-left: 21px !important;"><span id="curSymbol">'+a.responseData[0].currenySymbol+' </span> <span id="amountDueEInvoice">'+remitaUiCtrl.formatCurrency(a.responseData[0].amountDue)+"</span></b><br/>"+MESSAGE_BUNDLE["core.beneficiary"]+" :  <b>"+a.responseData[0].beneficiaryName+'<input type="hidden" id="amountToPay" value="'+remitaUiCtrl.formatCurrency(a.responseData[0].amount)+'"/></b>'):e.confirmRecieverEInvoice.html(MESSAGE_BUNDLE["core.amount.payable"]+' : <b style="margin-left: 21px !important;"><span id="curSymbol">'+a.responseData[0].currenySymbol+'</span> <span id="amountDueEInvoice">'+remitaUiCtrl.formatCurrency(a.responseData[0].netAmount)+"</span></b><br/>"+MESSAGE_BUNDLE["core.beneficiary"]+" :  <b>"+a.responseData[0].beneficiaryName+'<input type="hidden" id="amountToPay" value="'+remitaUiCtrl.formatCurrency(a.responseData[0].amount)+'"/></b>'),remitaUiCtrl.getBillersLogoAndConvertBase64ToImage(a.responseData[0].billerId,e),e.confirmRecieverEInvoice.append('<input type="hidden" id="serviceChargeAmount" value="'+remitaUiCtrl.formatCurrency(a.responseData[0].amount)+'"/>')}else $("#howDoYouWantToPayDivEInvoice").addClass("hidden"),$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'> "+MESSAGE_BUNDLE["core.this.RRR.has.been.processed"]+" </span>",0);else{$("#howDoYouWantToPayDivEInvoice").addClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden");r=a.responseMsg;e.billerNameEInvoice.html(""),e.billerLogoDivEInvoice.addClass("hidden"),e.confirmRecieverEInvoice.html(""),e.confirmRecieverEInvoice.addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'>"+r+"</span>",0)}},error:function(){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}}))},reloadInvoiceView:function(e){var t=eInvoiceCtrl.settings;$("#theamountiwanttopayEDiv").addClass("hidden"),$.ajax({url:t.apiURL+e+"/billsummaryfull.json",dataType:"text",success:function(a){var r=servicesCtrl.remitaDecode(a);if("00"==r.responseCode)if("SO"==r.responseData[0].rrrType||"DD"==r.responseData[0].rrrType)$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'> "+MESSAGE_BUNDLE["core.this.mandate.rrr"]+"  </span>",0);else if("PENDING"==r.responseData[0].status){$("#serviceTypeIdForEInvoice").val(r.responseData[0].serviceTypeId),"Y"==r.responseData[0].acceptPartPayment&&($("#theamountiwanttopayEDiv").removeClass("hidden"),$("#theAmountIWantToPay").prop("value",remitaUiCtrl.formatCurrency(r.responseData[0].amountDue))),remitaUiCtrl.hideFormErrors();var o=MESSAGE_BUNDLE["core.einvoice.successfully.processed"];if(t.billerLogoDivEInvoice.removeClass("hidden"),t.billerNameEInvoice.html('<h2  style="margin-bottom: 0px !important; padding-top: 10px !important;">'+r.responseData[0].beneficiaryName+"</h2>"),$("#RRRToPayEInvoice").val(e.match(/.{1,4}/g).join("-")),$("#payersEmailEInvoice").prop("value",r.responseData[0].payerEmail),$("#payersPhoneEInvoice").prop("value",r.responseData[0].payerMobile),$("#payersFullNameEInvoice").prop("value",r.responseData[0].payerName),t.confirmRecieverEInvoice.removeClass("hidden"),t.howDoYouWantToPayDiv.removeClass("hidden"),t.payerDetailsEInvoice.removeClass("hidden"),t.isIntegration){t.paymentType;$("#payersEmailEInvoice").prop("disabled","disabled"),$("#payersEmailEInvoice").prop("disabled","disabled"),$("#payersPhoneEInvoice").prop("disabled","disabled"),$("#payersFullNameEInvoice").prop("disabled","disabled"),$("#RRRToPayEInvoice").prop("disabled","disabled")}"Y"==r.responseData[0].acceptPartPayment?t.confirmRecieverEInvoice.html(MESSAGE_BUNDLE["core.amount.payable"]+' : <b style="margin-left: 21px !important;">'+r.responseData[0].currenySymbol+' <span id="amountDueEInvoice">'+remitaUiCtrl.formatCurrency(r.responseData[0].amountDue)+"</span></b><br/>"+MESSAGE_BUNDLE["core.beneficiary"]+" :  <b>"+r.responseData[0].beneficiaryName+'<input type="hidden" data-curCode="'+r.responseData[0].currency+'" id="amountToPay" value="'+remitaUiCtrl.formatCurrency(r.responseData[0].amount)+'"/></b>'):t.confirmRecieverEInvoice.html(MESSAGE_BUNDLE["core.amount.payable"]+' : <b style="margin-left: 21px !important;">'+r.responseData[0].currenySymbol+' <span id="amountDueEInvoice">'+remitaUiCtrl.formatCurrency(r.responseData[0].netAmount)+"</span></b><br/>"+MESSAGE_BUNDLE["core.beneficiary"]+" :  <b>"+r.responseData[0].beneficiaryName+'<input type="hidden" data-curCode="'+r.responseData[0].currency+'" id="amountToPay" value="'+remitaUiCtrl.formatCurrency(r.responseData[0].amount)+'"/></b>'),remitaUiCtrl.getBillersLogoAndConvertBase64ToImage(r.responseData[0].billerId,t)}else $("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'> "+MESSAGE_BUNDLE["core.this.RRR.has.been.processed"]+"</span>",0);else{$("#hideServiceChargeDiv").addClass("hidden"),$("#howDoYouWantToPayEInvoice").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden");o=r.responseMsg;t.billerNameEInvoice.html(""),t.billerLogoDivEInvoice.addClass("hidden"),t.confirmRecieverEInvoice.html(""),t.confirmRecieverEInvoice.addClass("hidden"),remitaUiCtrl.showFormErrors("<span class='animated flash visible' style='color:#de4b37 !important;'>"+o+"</span>",0)}},error:function(){remitaUiCtrl.showFormErrors(MESSAGE_BUNDLE["core.sorry.you.cannot.complete.your.operation.on.this.page.right.now.please.contact.remita.support.to.proceed"])},complete:function(){}})}};function setCardMask(e){cardMaskCtrl.createCardMask("#card_number",{behaviour:function(t){return/^[^0-9]{1}/.test(t)?"0000000000":e}})}function removeCardMask(){$("#card_number").unmask()}function getUrlParameter(e){var t=window.location.href,a=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(t);return a?a[1]:null}function setCardMask(e){cardMaskCtrl.createCardMask("#card_number",{behaviour:function(t){return/^[^0-9]{1}/.test(t)?"0000000000":e}})}function removeCardMask(){$("#card_number").unmask()}function validateCardDetails(e){var t=e.find("[data-card-id]");t.length>0&&t.validateCreditCard(function(e){null==e.card_type?(t.removeClass(),t.val().match(/^506/)&&("0000 0000 0000 0000 000"!==remitaUiCtrl.settings.cardPattern&&(remitaUiCtrl.settings.cardPattern="0000 0000 0000 0000 000",removeCardMask(),setCardMask(remitaUiCtrl.settings.cardPattern)),t.addClass("verve"))):("0000 0000 0000 0000"!==remitaUiCtrl.settings.cardPattern&&(remitaUiCtrl.settings.cardPattern="0000 0000 0000 0000",removeCardMask(),setCardMask(remitaUiCtrl.settings.cardPattern)),t.addClass(e.card_type.name))})}function validateCusInput(e){var t,a=$(e).attr("data-colltype");"AN"==a&&(t=(t=$(e).val()).replace(/[\W_]/g,""),$(e).val(t));"N"==a&&(t=(t=$(e).val()).replace(/[^0-9]/g,""),$(e).val(t));"A"==a&&(t=(t=$(e).val()).replace(/[^A-Za-z]/g,""),$(e).val(t));return!0}function validatefrq(e){var t=$(e).val();return isNaN(t)?t=t.replace(t,""):t<=0&&(t=t.replace(t,"")),$(e).val(t),!0}function validatemaxupload(e){var t=$(e).val();return isNaN(t)?t=t.replace(t,""):t<=0?t=t.replace(t,""):t>31&&(t=t.replace(t,"")),$(e).val(t),!0}function allowOnlyNumbers(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65===e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}eInvoiceCtrl.generatePaymentRRRErrorHandler=function(e){},eInvoiceCtrl.makePaymentOnSuccessCallbackFn=function(e){if(eInvoiceCtrl.generatedPayload.merchantRedirectUrl&&null===eInvoiceCtrl.generatedPayload.merchantRedirectUrl.match(/onepage\/pred\.spa/)){var t=servicesCtrl.remitaEncode(JSON.stringify({paymentRef:eInvoiceCtrl.generatedPayload.rrrNumber}));window.location=eInvoiceCtrl.generatedPayload.merchantRedirectUrl+"?p="+t}else{var a=eInvoiceCtrl.generatedPayload.rrrNumber;servicesCtrl.setLocalData("ib"+a,"null"),servicesCtrl.setLocalData("rrr"+a,{responseCode:"00",responseMsg:"successful"}),remitaUiCtrl.generateReceiptWithRrr(a,!1)}},eInvoiceCtrl.makePaymentOnErrorCallbackFn=function(){$("#processingInvoice").addClass("hidden")},eInvoiceCtrl.makePaymentOnCloseFn=function(){$("#processingInvoice").addClass("hidden")},eInvoiceCtrl.handleGenBillAndPaymentLog=function(e,t,a){if($("#theAmountIWantToPay")&&e<t){return servicesCtrl.generatePaymentRRR("/remita/onepage/cloud/send/api/billsvc/biller/genPartBillPayment.json",{rrr:a,amount:e}).then(function(e){var t=servicesCtrl.remitaDecode(e).responseData[0];return eInvoiceCtrl.settings.paymentLogData.narration=t.descriptionOfPayment||a+" - NARRATION",eInvoiceCtrl.settings.paymentLogData.amount=t.amount,eInvoiceCtrl.settings.paymentLogData.rrr=t.rrrNumber,servicesCtrl.logPayment(eInvoiceCtrl.settings.paymentLogData)})}return servicesCtrl.logPayment(eInvoiceCtrl.settings.paymentLogData)},$(function(){$(document).ajaxSend(function(){NProgress.start(),$("#headerLoading").removeClass("hidden")}),$(document).ajaxComplete(function(){NProgress.done(),NProgress.remove(),$("#headerLoading").addClass("hidden")}),maskCtrl.createMask("#RRRToPayEInvoice"),cardMaskCtrl.createCardMask("#card_number"),$(".selectmpickera").multiselect({includeSelectAllOption:!1}),$(document).on("blur","#expiringDate",function(){var e=remitaUiCtrl.checkForExpireCardDate("expiringDate");e?remitaUiCtrl.showFormErrors("This card is expired. Please use valid card details"):$("#error-div").addClass("hidden")}),$(document).on("keypress","#cardHolder",function(e){var t=e.keyCode?e.keyCode:e.which;t>47&&t<58&&e.preventDefault()}),$(document).on("blur","#cvc",function(e){$("#cvc").val().length<3?remitaUiCtrl.showFormErrors("Invalid CVV Number"):($("#cvc").removeClass("form-error"),$("#error-div").addClass("hidden"))}),$(document).on("keydown","#cvc",function(e){allowOnlyNumbers(e)}),$(document).on("keypress",".itemTotal",function(e){(46!=e.which||-1!=$(this).val().indexOf("."))&&(e.which<48||e.which>57)&&$(this).val().length<=13&&(46==e.keyCode||8==e.keyCode||9==e.keyCode||e.preventDefault())}),$(document).ready(function(){$(".disable-copy").bind("cut copy paste",function(e){e.preventDefault()})}),$(document).ready(function(){$(".confirm-email").on("blur",function(e){var t=$(this).attr("id"),a=$(this).attr("id").split("_")[0],r=$("#"+a).val(),o=$(this).val();!(null===remitaUiCtrl.settings.allowEmail||remitaUiCtrl.settings.allowEmail&&"N"===remitaUiCtrl.settings.allowEmail.allowNoEmail)||remitaUiCtrl.validateEmailAddress(t)?(remitaUiCtrl.hideFormErrors(),$(this).removeClass("form-error"),o!=r&&null===remitaUiCtrl.settings.allowEmail||o!=r&&remitaUiCtrl.settings.allowEmail&&"N"===remitaUiCtrl.settings.allowEmail.allowNoEmail?(remitaUiCtrl.showFormErrors("Please confirm your email address"),$(this).addClass("form-error"),$("#"+a).addClass("form-error")):(remitaUiCtrl.hideFormErrors(),$(this).removeClass("form-error"),$("#"+a).removeClass("form-error"))):(remitaUiCtrl.showFormErrors("Please enter a valid email address"),$(this).addClass("form-error"))})}),$(document).ready(function(){$(".email").on("blur",function(e){var t=$(this).attr("id"),a=$("#"+t+"_confirm").val(),r=$(this).val();!(null===remitaUiCtrl.settings.allowEmail||remitaUiCtrl.settings.allowEmail&&"N"===remitaUiCtrl.settings.allowEmail.allowNoEmail)||remitaUiCtrl.validateEmailAddress(t)?(remitaUiCtrl.hideFormErrors(),$(this).removeClass("form-error"),a!=r&&null===remitaUiCtrl.settings.allowEmail||a!=r&&remitaUiCtrl.settings.allowEmail&&"N"===remitaUiCtrl.settings.allowEmail.allowNoEmail?""!=a&&($(this).addClass("form-error"),$("#"+t+"_confirm").addClass("form-error"),remitaUiCtrl.showFormErrors("Please confirm your email address")):(remitaUiCtrl.hideFormErrors(),$(this).removeClass("form-error"),$("#"+t+"_confirm").removeClass("form-error"))):(remitaUiCtrl.showFormErrors("Please enter a valid email address"),$(this).addClass("form-error"))})}),$(document).on("keydown",".itemTotal",function(e){$(this).val().length>13&&(46==e.keyCode||8==e.keyCode||9==e.keyCode||e.preventDefault())}),$(document).on("keydown",".accountnumber",function(e){allowOnlyNumbers(e)}),$(document).on("blur",".itemTotal",function(){remitaUiCtrl.formatMoneyInput(this)});var e=(r=new Date).getDate(),t=r.getMonth()+1,a=r.getFullYear();e<10&&(e="0"+e),t<10&&(t="0"+t);var r=e+"-"+t+"-"+a;if($(".form_date").daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD-MM-YYYY"},minDate:r}),remitaUiCtrl.validatePhoneNumber("benPhone"),remitaUiCtrl.validatePhoneNumber("payersPhone"),remitaUiCtrl.validatePhoneNumber("payersPhoneEInvoice"),remitaUiCtrl.validatePhoneNumber("payersPhoneStandinOrder"),remitaUiCtrl.validatePhoneNumber("benPhoneStandinOrder"),$("#expiringDateStandinOrder").mask("00/00",{placeholder:"01/16"}),$("#expiringDate").mask("00/00",{placeholder:"01/16"}),$(document).on("change","#howDoYouWantToPay",function(e){e.stopPropagation();var t=$(e.currentTarget);if("CARD"===t.val()){var a=t.closest("div").next('[id*="showHowDoYouWantToPay"]');validateCardDetails(a)}}),$(document).on("blur","#endNumType",function(){var e=$("#endNumType").val(),t=$("#everyStandinOrder").val();if(""==t)remitaUiCtrl.showFormErrors("Please select Frequency"),$("#everyStandinOrder").addClass("form-error");else if(""==e);else{var a=$("#startDateStandinOrder").val();$("#everyStandinOrder").removeClass("form-error"),a=a.split("-")[2]+"-"+a.split("-")[1]+"-"+a.split("-")[0];var r=parseInt($("#endNumType").val());switch(r-=1,t){case"D":var o=moment(a).add(r,"day").format("YYYY-MM-DD");break;case"WK":o=moment(a).add(r,"week").format("YYYY-MM-DD");break;case"MON":o=moment(a).add(r,"months").format("YYYY-MM-DD");break;case"QRT":o=moment(a).add(3*r,"months").format("YYYY-MM-DD");break;case"HYR":o=moment(a).add(6*r,"months").format("YYYY-MM-DD");break;case"YR":o=moment(a).add(r,"year").format("YYYY-MM-DD")}o=o.split("-")[2]+"-"+o.split("-")[1]+"-"+o.split("-")[0],$("#endDateType").val(o)}}),$(document).on("change","#everyStandinOrder",function(){$("#everyStandinOrder").removeClass("form-error"),$("#startDateStandinOrder").val(""),$("#endNumType").val(""),$("#endDateType").val("")}),$(document).on("change","#startDateStandinOrder",function(){$("#endNumType").val("");var e=$("#everyStandinOrder").val();if(""==e)remitaUiCtrl.showFormErrors("Please select Frequency"),$("#everyStandinOrder").addClass("form-error");else{var t=$("#startDateStandinOrder").val();$("#everyStandinOrder").removeClass("form-error");switch(t=t.split("-")[2]+"-"+t.split("-")[1]+"-"+t.split("-")[0],e){case"D":var a=moment(t).add(0,"day").format("YYYY-MM-DD");break;case"WK":a=moment(t).add(0,"week").format("YYYY-MM-DD");break;case"MON":case"QRT":case"HYR":a=moment(t).add(0,"months").format("YYYY-MM-DD");break;case"YR":a=moment(t).add(0,"year").format("YYYY-MM-DD")}a=a.split("-")[2]+"-"+a.split("-")[1]+"-"+a.split("-")[0],$("#endDateType").val(a)}}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("href");"#recurringPayment"==t?($('[for="nameOfServiceOrPurpose"]').html('Name of service/purpose<span class="red-text"> *</span>'),$("#nameOfServiceOrPurpose").removeClass("hidden"),$("#nameOfServiceOrPurpose").closest(".form-group").find(".service-type-cards-holder .service-row").html(""),standinOrderCtrl.activate(),remitaUiCtrl.clearServiceChargeForm(),null!=document.getElementById("CustomForm")&&"null"!=document.getElementById("CustomForm")&&void 0!=document.getElementById("CustomForm")&&"undefined"!=document.getElementById("CustomForm")&&document.getElementById("CustomForm").reset(),null!=document.getElementById("mainForm")&&"null"!=document.getElementById("mainForm")&&void 0!=document.getElementById("mainForm")&&"undefined"!=document.getElementById("mainForm")&&document.getElementById("mainForm").reset(),null!=document.getElementById("paymentDetails")&&"null"!=document.getElementById("paymentDetails")&&void 0!=document.getElementById("paymentDetails")&&"undefined"!=document.getElementById("paymentDetails")&&document.getElementById("paymentDetails").reset(),null!=document.getElementById("mainFormEInvoice")&&"null"!=document.getElementById("mainFormEInvoice")&&void 0!=document.getElementById("mainFormEInvoice")&&"undefined"!=document.getElementById("mainFormEInvoice")&&document.getElementById("mainFormEInvoice").reset(),$("#submitEInvoice").removeClass("hidden"),$("#submit").removeClass("hidden"),$("input").removeClass("error"),$("input").removeClass("form-error"),$("select").removeClass("error"),$("select").removeClass("form-error"),$("#billerName").addClass("hidden"),$("#uploadType").addClass("hidden"),$("#billerLogo").addClass("hidden"),$("#billerLogoDivEInvoice").addClass("hidden"),$("#showHowDoYouWantToPayCustomFields").html(""),$("#billerNameEInvoice").html(""),$("#confirmRecieverEInvoice").html(""),$("#payerDetailsEInvoice").addClass("hidden"),$("#howDoYouWantToPayDivEInvoice").addClass("hidden"),$(".float-left-div").addClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#itemTotal").prop("placeholder",""),$("#itemTotal").removeAttr("disabled"),$("#customFields").addClass("hidden"),$("#processingInvoice").addClass("hidden"),$("#showhowDoYouWantToPayEInvoiceCustomFields").addClass("hidden"),$(".captchaError").addClass("hidden"),grecaptcha.reset(widgetId1),$("#customFields").html(""),$("#showServiceCharge").addClass("hidden"),$("#showServiceChargeStandinOrder").addClass("hidden"),$("#instruction").addClass("hidden"),$("#instructionMsg").html(""),$("#instructionTitleDiv").attr("style","background:#000; padding:15px"),$("#instruction").attr("style","background:#f2f2f2;")):"#payOnce"==t?(remitaUiCtrl.clearServiceChargeForm(),$('[for="nameOfServiceOrPurposeStandinOrder"]').html('Name of service/purpose<span class="red-text"> *</span>'),$("#nameOfServiceOrPurposeStandinOrder").removeClass("hidden"),$("#nameOfServiceOrPurposeStandinOrder").closest(".form-group").find(".service-type-cards-holder .service-row").html(""),null!=document.getElementById("mainFormStandinOrder")&&"null"!=document.getElementById("mainFormStandinOrder")&&void 0!=document.getElementById("mainFormStandinOrder")&&"undefined"!=document.getElementById("mainFormStandinOrder")&&document.getElementById("mainFormStandinOrder").reset(),null!=document.getElementById("CustomFormStandinOrder")&&"null"!=document.getElementById("CustomFormStandinOrder")&&void 0!=document.getElementById("CustomFormStandinOrder")&&"undefined"!=document.getElementById("CustomFormStandinOrder")&&document.getElementById("CustomFormStandinOrder").reset(),null!=document.getElementById("paymentDetailsStandinOrder")&&"null"!=document.getElementById("paymentDetailsStandinOrder")&&void 0!=document.getElementById("paymentDetailsStandinOrder")&&"undefined"!=document.getElementById("paymentDetailsStandinOrder")&&document.getElementById("paymentDetailsStandinOrder").reset(),null!=document.getElementById("mainFormEInvoice")&&"null"!=document.getElementById("mainFormEInvoice")&&void 0!=document.getElementById("mainFormEInvoice")&&"undefined"!=document.getElementById("mainFormEInvoice")&&document.getElementById("mainFormEInvoice").reset(),$("input").removeClass("error"),$("input").removeClass("form-error"),$("select").removeClass("error"),$("select").removeClass("form-error"),$("#billerNameStandinOrder").addClass("hidden"),$("#submitEInvoice").removeClass("hidden"),$("#submitStandinOrder").removeClass("hidden"),$("#billerName").addClass("hidden"),$("#uploadType").addClass("hidden"),$("#billerLogo").addClass("hidden"),$("#billerLogoStandinOrder").addClass("hidden"),$("#billerLogoDivEInvoice").addClass("hidden"),$("#showHowDoYouWantToPayCustomFields").html(""),$("#billerNameEInvoice").html(""),$("#itemTotalStandinOrder").prop("placeholder",""),$("#itemTotalStandinOrder").removeAttr("disabled"),$("#confirmRecieverEInvoice").html(""),$(".captchaErrorStandinOrder").addClass("hidden"),$("#payerDetailsEInvoice").addClass("hidden"),$("#howDoYouWantToPayDivEInvoice").addClass("hidden"),$(".float-left-div").addClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#customFieldsStandinOrder").addClass("hidden"),$("#processingInvoiceStandinOrder").addClass("hidden"),$("#showhowDoYouWantToPayEInvoiceCustomFields").addClass("hidden"),$("#customFieldsStandinOrder").html(""),remitaUiCtrl.clearServiceChargeForm(),$("#error-div").addClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#showServiceCharge").addClass("hidden"),$("#showServiceChargeStandinOrder").addClass("hidden"),$("#instruction").addClass("hidden"),$("#instructionMsg").html(""),grecaptcha.reset(widgetId2),$("#instructionTitleDiv").attr("style","background:#000; padding:15px"),$("#instructionMsg").html("All the fields with arterisk (*) are required to be filled, Please ensure you supply valid input in all of such fields <br/> Thanks"),$("#instruction").attr("style","background:#f2f2f2;")):"#eInvoice"==t&&($('[for="nameOfServiceOrPurpose"]').html('Name of service/purpose<span class="red-text"> *</span>'),$("#nameOfServiceOrPurpose").removeClass("hidden"),$("#nameOfServiceOrPurpose").closest(".form-group").find(".service-type-cards-holder .service-row").html(""),$('[for="nameOfServiceOrPurposeStandinOrder"]').html('Name of service/purpose<span class="red-text"> *</span>'),$("#nameOfServiceOrPurposeStandinOrder").removeClass("hidden"),$("#nameOfServiceOrPurposeStandinOrder").closest(".form-group").find(".service-type-cards-holder .service-row").html(""),null!=document.getElementById("mainFormStandinOrder")&&"null"!=document.getElementById("mainFormStandinOrder")&&void 0!=document.getElementById("mainFormStandinOrder")&&"undefined"!=document.getElementById("mainFormStandinOrder")&&document.getElementById("mainFormStandinOrder").reset(),null!=document.getElementById("CustomFormStandinOrder")&&"null"!=document.getElementById("CustomFormStandinOrder")&&void 0!=document.getElementById("CustomFormStandinOrder")&&"undefined"!=document.getElementById("CustomFormStandinOrder")&&document.getElementById("CustomFormStandinOrder").reset(),null!=document.getElementById("paymentDetailsStandinOrder")&&"null"!=document.getElementById("paymentDetailsStandinOrder")&&void 0!=document.getElementById("paymentDetailsStandinOrder")&&"undefined"!=document.getElementById("paymentDetailsStandinOrder")&&document.getElementById("paymentDetailsStandinOrder").reset(),null!=document.getElementById("mainFormEInvoice")&&"null"!=document.getElementById("mainFormEInvoice")&&void 0!=document.getElementById("mainFormEInvoice")&&"undefined"!=document.getElementById("mainFormEInvoice")&&document.getElementById("mainFormEInvoice").reset(),$("#submitStandinOrder").removeClass("hidden"),$("#submit").removeClass("hidden"),$("input").removeClass("error"),$("input").removeClass("form-error"),$("select").removeClass("error"),$("select").removeClass("form-error"),$("#billerNameStandinOrder").addClass("hidden"),$("#billerName").addClass("hidden"),$("#uploadType").addClass("hidden"),$("#billerLogo").addClass("hidden"),$("#billerLogoStandinOrder").addClass("hidden"),$("#itemTotalStandinOrder").prop("placeholder",""),$("#itemTotalStandinOrder").removeAttr("disabled"),$(".float-left-div").addClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#showhowDoYouWantToPayEInvoiceCustomFields").addClass("hidden"),$("#customFieldsStandinOrder").addClass("hidden"),$("#processingInvoiceStandinOrder").addClass("hidden"),$(".captchaError").addClass("hidden"),$(".captchaErrorStandinOrder").addClass("hidden"),$("#processingInvoice").addClass("hidden"),$("#showHowDoYouWantToPayCustomFields").html(""),$("#customFieldsStandinOrder").html(""),eInvoiceCtrl.activate(),null!=document.getElementById("mainForm")&&"null"!=document.getElementById("mainForm")&&void 0!=document.getElementById("mainForm")&&"undefined"!=document.getElementById("mainForm")&&document.getElementById("mainForm").reset(),null!=document.getElementById("CustomForm")&&"null"!=document.getElementById("CustomForm")&&void 0!=document.getElementById("CustomForm")&&"undefined"!=document.getElementById("CustomForm")&&document.getElementById("CustomForm").reset(),null!=document.getElementById("paymentDetails")&&"null"!=document.getElementById("paymentDetails")&&void 0!=document.getElementById("paymentDetails")&&"undefined"!=document.getElementById("paymentDetails")&&document.getElementById("paymentDetails").reset(),null!=document.getElementById("mainFormEInvoice")&&"null"!=document.getElementById("mainFormEInvoice")&&void 0!=document.getElementById("mainFormEInvoice")&&"undefined"!=document.getElementById("mainFormEInvoice")&&document.getElementById("mainFormEInvoice").reset(),$("#billerName").addClass("hidden"),$("#billerLogo").addClass("hidden"),$("#hideServiceChargeDiv").addClass("hidden"),$("#itemTotal").prop("placeholder",""),$("#itemTotal").removeAttr("disabled"),$("#customFields").addClass("hidden"),$("#customFields").html(""),remitaUiCtrl.clearServiceChargeForm(),$("#hideServiceChargeDiv").addClass("hidden"),$("#showServiceCharge").addClass("hidden"),$("#showServiceChargeStandinOrder").addClass("hidden"),$("#instruction").addClass("hidden"),$("#instructionMsg").html(""),$("#instructionTitleDiv").attr("style","background:#000; padding:15px"),$("#instructionMsg").html("Type in the RRR you want to pay"),$("#instruction").attr("style","background:#f2f2f2;"))}),getUrlParameter("p")){var o=$.base64.decode(location.search.split("p=")[1]),n=JSON.parse(o);servicesCtrl.setLocalData("rrr"+n.paymentRef,n),remitaUiCtrl.generateReceiptWithRrr(n.paymentRef,!0)}else if(getUrlParameter("responseCode"))o=location.search.split("responseCode=")[1];$(document).on("click","#retryPaymentButton",function(){var e=$("#rrr").text().replace(/-/gi,"");window.location="biller/"+e+"/payment.spa"}),document.getElementById("close-iframe").addEventListener("click",function(e){},!1),window.matchMedia("print").addListener(function(e){e.matches&&$(".payment-details").removeClass("hidden")})}),$(document).ready(function(){$("#submit").removeClass("hidden"),$(document).on("change","#uploadFile",function(){$("#progress").addClass("hidden"),$("#myForm").submit(),$("#reviewUpload").addClass("hidden"),$("#uploadFile").addClass("ui-autocomplete-loading")}),$(document).on("blur","#customFields > div > input:first",function(){$("#employerCode").prop("value",$(this).val())}),$("#reviewUpload").click(function(){$("#collectorId").val();var e=$("#requestId").val(),t=$(".serviceTypeId").val(),a=$("#customFields > div > input:first").val();$("#modal-fileupload").on("shown.bs.modal",function(r){$(this);$("#fileuploadTable").DataTable({processing:!0,serverSide:!0,bPaginate:!0,searching:!1,ajax:{url:pageSettings.contextPath+"/doupload/paged/preview.json",method:"get",data:{uploadStatus:"good",collectorId:t,requestId:e,employerCode:a}},rowCallback:function(e,t){},drawCallback:function(e){e.json.good||$("#submit").addClass("hidden")}})}),$("#modal-fileupload").modal({backdrop:"static",keyboard:!1})});var e={dataType:"json",beforeSend:function(){$("#progress").addClass("hidden"),$("#bar").width("0%"),$("#message").html(""),$("#percent").html("0%")},uploadProgress:function(e,t,a,r){$("#bar").addClass("hidden"),$("#progress").removeClass("hidden"),$("#uploadFile").addClass("ui-autocomplete-loading"),$("#bar").width(r+"%"),$("#percent").html(r+"%")},success:function(e){if(e.responseCode){if($("#getTempForm").append("<input type='hidden' name='requestId' style='max-width:1600px !important' id='requestId' value='"+e.requestId+"' />"),$("#progress").addClass("hidden"),$("#uploadFile").removeClass("ui-autocomplete-loading"),e.responseCode="Failed"!=e.responseMsg){$("#requestId").val(e.requestId),1==e.good?($("#submit").removeClass("hidden"),$("#itemTotal").prop("value",remitaUiCtrl.formatCurrency(e.totalAmount)),$("#itemTotal").prop("disabled","disabled"),$("#totalAmoutToPay2").prop("value",e.totalAmount),$("#message").html("<font color='green'>"+e.responseMsg+"  "+MESSAGE_BUNDLE["core.count"]+" ("+e.okRecCount+")</font>")):($("#submit").addClass("hidden"),$("#message").html("<font color='red'>"+e.responseMsg+" </font>"));var t="";$(e.responseHeaders).each(function(e,a){t+="<th>"+a+" </th>"}),$("#tableHead").append(t)}$("#reviewUpload").removeClass("hidden")}else $("#progress").addClass("hidden"),$("#message").html("<font color='red'>"+e.responseError+"</font>")},complete:function(e){$("#progress").addClass("hidden"),$("#uploadFile").removeClass("ui-autocomplete-loading")},error:function(e){$("#progress").addClass("hidden"),$("#message").html("<font color='red'> "+MESSAGE_BUNDLE["core.error.unable.to.upload.files"]+"</font>")}};$("#myForm").ajaxForm(e)});